var H=(B)=>typeof B==="function",g=(B,K)=>Object.prototype.toString.call(B)===`[object ${K}]`,f=(B)=>B instanceof Error?B:Error(String(B));class S extends Error{constructor(B){super(`Circular dependency in ${B} detected`);return this}}var _,v=new Set,s=0,l=new Map,c,WB=()=>{c=void 0;let B=Array.from(l.values());l.clear();for(let K of B)K()},YB=()=>{if(c)cancelAnimationFrame(c);c=requestAnimationFrame(WB)};queueMicrotask(WB);var m=(B)=>{let K=new Set,$=B;return $.off=(W)=>{K.add(W)},$.cleanup=()=>{for(let W of K)W();K.clear()},$},D=(B)=>{if(_&&!B.has(_)){let K=_;B.add(K),_.off(()=>{B.delete(K)})}},M=(B)=>{for(let K of B)if(s)v.add(K);else K()},u=()=>{while(v.size){let B=Array.from(v);v.clear();for(let K of B)K()}},ZB=(B)=>{s++;try{B()}finally{u(),s--}},d=(B,K)=>{let $=_;_=K;try{B()}finally{_=$}},N=(B,K)=>new Promise(($,W)=>{l.set(K||Symbol(),()=>{try{$(B())}catch(Z){W(Z)}}),YB()});var r="State",i=(B)=>{let K=new Set,$=B,W={[Symbol.toStringTag]:r,get:()=>{return D(K),$},set:(Z)=>{if(Object.is($,Z))return;if($=Z,M(K),j===$)K.clear()},update:(Z)=>{W.set(Z($))}};return W},C=(B)=>g(B,r);var p="Computed",o=(B)=>{let K=new Set,$=j,W,Z,J=!0,z=!1,G=!1,Y=(V)=>{if(!Object.is(V,$))$=V,z=!0;W=void 0,J=!1},I=()=>{z=j!==$,$=j,W=void 0},X=(V)=>{let x=f(V);z=!W||x.name!==W.name||x.message!==W.message,$=j,W=x},q=(V)=>(x)=>{if(G=!1,Z=void 0,V(x),z)M(K)},A=m(()=>{if(J=!0,Z?.abort("Aborted because source signal changed"),K.size)M(K);else A.cleanup()}),y=()=>d(()=>{if(G)throw new S("computed");if(z=!1,H(B)&&B.constructor.name==="AsyncFunction"){if(Z)return $;Z=new AbortController,Z.signal.addEventListener("abort",()=>{G=!1,Z=void 0,y()},{once:!0})}let V;G=!0;try{V=Z?B(Z.signal):B()}catch(x){if(x instanceof DOMException&&x.name==="AbortError")I();else X(x);G=!1;return}if(V instanceof Promise)V.then(q(Y),q(X));else if(V==null||j===V)I();else Y(V);G=!1},A);return{[Symbol.toStringTag]:p,get:()=>{if(D(K),u(),J)y();if(W)throw W;return $}}},k=(B)=>g(B,p),a=(B)=>H(B)&&B.length<2;var j=Symbol(),P=(B)=>C(B)||k(B),b=(B)=>P(B)?B:a(B)?o(B):i(B);function h(B){let{signals:K,ok:$,err:W=console.error,nil:Z=()=>{}}=H(B)?{signals:[],ok:B}:B,J=!1,z=m(()=>d(()=>{if(J)throw new S("effect");J=!0;let G=[],Y=!1,I=K.map((q)=>{try{let A=q.get();if(A===j)Y=!0;return A}catch(A){return G.push(f(A)),j}}),X=void 0;try{X=Y?Z():G.length?W(...G):$(...I)}catch(q){X=W(f(q))}finally{if(H(X))z.off(X)}J=!1},z));return z(),()=>z.cleanup()}var U=!1,HB="debug",QB="info",jB="warn",E="error",VB=(B)=>B?`#${B}`:"",FB=(B)=>B.length?`.${Array.from(B).join(".")}`:"",t=(B)=>!!B&&typeof B==="object",O=(B)=>typeof B==="string",JB=(B)=>B.nodeType===Node.ELEMENT_NODE,Q=(B)=>`<${B.localName}${VB(B.id)}${FB(B.classList)}>`,T=(B)=>O(B)?`"${B}"`:t(B)?JSON.stringify(B):String(B),n=(B)=>{if(B===null)return"null";if(typeof B!=="object")return typeof B;if(Array.isArray(B))return"Array";if(Symbol.toStringTag in Object(B))return B[Symbol.toStringTag];return B.constructor?.name||"Object"},F=(B,K,$="debug")=>{if(["error","warn"].includes($))console[$](K,B);return B};class zB extends Error{constructor(B){super(B);this.name="CircularMutationError"}}var AB=(B)=>B instanceof HTMLElement&&B.localName.includes("-"),LB=(B)=>{let K=new Set;if(B.includes("."))K.add("class");if(B.includes("#"))K.add("id");if(B.includes("[")){let $=B.split("[");for(let W=1;W<$.length;W++){let Z=$[W];if(!Z.includes("]"))continue;let J=Z.split("=")[0].trim().replace(/[^a-zA-Z0-9_-]/g,"");if(J)K.add(J)}}return[...K]},qB=(B,K)=>{if(B.length!==K.length)return!1;let $=new Set(B);for(let W of K)if(!$.has(W))return!1;return!0},e=(B,K,$)=>{let W=new MutationObserver($),Z=LB(K),J={childList:!0,subtree:!0};if(Z.length)J.attributes=!0,J.attributeFilter=Z;return W.observe(B,J),W},xB=(B,K)=>{let $=new Set,W=()=>Array.from(B.querySelectorAll(K)),Z=j,J,z=0,G=2,Y=()=>{Z=W(),J=e(B,K,()=>{if(!$.size){J?.disconnect(),J=void 0;return}if(z++,z>G)throw J?.disconnect(),J=void 0,z=0,new zB("Circular mutation in element selection detected");try{let X=W();if(!qB(Z,X))Z=X,M($)}finally{z--}})};return{[Symbol.toStringTag]:p,get:()=>{if(D($),!$.size)Z=W();else if(!J)Y();return Z}}},CB=(B,K)=>($,W=$)=>{if(!H(K))throw new TypeError(`Invalid event listener provided for "${B} event on element ${Q(W)}`);return W.addEventListener(B,K),()=>W.removeEventListener(B,K)},UB=(B,K)=>($,W=$)=>{W.dispatchEvent(new CustomEvent(B,{detail:H(K)?K(W):K,bubbles:!0}))},MB=(B)=>(K,$)=>{let W=$.localName;if(!AB($))throw new TypeError("Target element must be a custom element");let Z=H(B)?B($):B;if(!t(Z))throw new TypeError("Passed signals must be an object or a provider function");customElements.whenDefined(W).then(()=>{for(let[J,z]of Object.entries(Z)){let G=O(z)?K.getSignal(J):b(z);$.setSignal(J,G)}}).catch((J)=>{throw new Error(`Failed to pass signals to ${Q($)}}`,{cause:J})})};var w=Symbol(),PB=new Set(Object.getOwnPropertyNames(HTMLElement.prototype)),OB=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString"]),BB=(B)=>H(B)&&B.length>=2,RB=(B)=>!(PB.has(B)||OB.has(B)),$B=(B,K,$=K)=>{let W=B.filter(H).map((Z)=>Z(K,$));return()=>{W.filter(H).forEach((Z)=>Z()),W.length=0}},yB=()=>({first:(B,...K)=>($)=>{let W=($.shadowRoot||$).querySelector(B);if(W)$B(K,$,W)},all:(B,...K)=>($)=>{let W=new Map,Z=$.shadowRoot||$,J=(I)=>{if(!W.has(I))W.set(I,$B(K,$,I))},z=(I)=>{let X=W.get(I);if(H(X))X();W.delete(I)},G=(I)=>(X)=>{if(JB(X)){if(X.matches(B))I(X);X.querySelectorAll(B).forEach(I)}},Y=e(Z,B,(I)=>{for(let X of I)X.addedNodes.forEach(G(J)),X.removedNodes.forEach(G(z))});return Z.querySelectorAll(B).forEach(J),()=>{Y.disconnect(),W.forEach((I)=>I()),W.clear()}}}),_B=(B,K={},$)=>{class W extends HTMLElement{debug;#B={};#$;static observedAttributes=Object.entries(K)?.filter(([,Z])=>BB(Z)).map(([Z])=>Z)??[];constructor(){super();for(let[Z,J]of Object.entries(K)){if(J==null)continue;let z=BB(J)?J(this,null):H(J)?J(this):J;if(z!=null)this.setSignal(Z,b(z))}}connectedCallback(){if(U){if(this.debug=this.hasAttribute("debug"),this.debug)F(this,"Connected")}let Z=$(this,yB());if(!Array.isArray(Z))throw new TypeError(`Expected array of functions as return value of setup function in ${Q(this)}`);this.#$=$B(Z,this)}disconnectedCallback(){if(H(this.#$))this.#$();if(U&&this.debug)F(this,"Disconnected")}attributeChangedCallback(Z,J,z){if(z===J||k(this.#B[Z]))return;let G=K[Z];if(!BB(G))return;let Y=G(this,z,J);if(U&&this.debug)F(z,`Attribute "${Z}" of ${Q(this)} changed from ${T(J)} to ${T(z)}, parsed as <${n(Y)}> ${T(Y)}`);this[Z]=Y}getSignal(Z){let J=this.#B[Z];if(U&&this.debug)F(J,`Get ${n(J)} "${String(Z)}" in ${Q(this)}`);return J}setSignal(Z,J){if(!RB(String(Z)))throw new TypeError(`Invalid property name "${String(Z)}". Property names must be valid JavaScript identifiers and not conflict with inherited HTMLElement properties.`);if(!P(J))throw new TypeError(`Expected signal as value for property "${String(Z)}" on ${Q(this)}.`);let z=this.#B[Z],G=C(J);if(this.#B[Z]=J,Object.defineProperty(this,Z,{get:J.get,set:G?J.set:void 0,enumerable:!0,configurable:G}),z&&C(z))z.set(j);if(U&&this.debug)F(J,`Set ${n(J)} "${String(Z)} in ${Q(this)}`)}}return customElements.define(B,W),W};var KB="context-request";class GB extends Event{context;callback;subscribe;constructor(B,K,$=!1){super(KB,{bubbles:!0,composed:!0});this.context=B;this.callback=K;this.subscribe=$}}var DB=(B)=>(K)=>{let $=(W)=>{let{context:Z,callback:J}=W;if(B.includes(Z)&&H(J))W.stopPropagation(),J(K.getSignal(String(Z)))};return K.addEventListener(KB,$),()=>K.removeEventListener(KB,$)},NB=(B)=>(K)=>{let $;return K.dispatchEvent(new GB(B,(W)=>{$=W})),$};var IB=(B,K)=>{if(K==null)return;let $=B(K);return Number.isFinite($)?$:void 0},TB=(B,K)=>K!=="false"&&K!=null,wB=(B=0)=>(K,$)=>IB(parseInt,$)??B,SB=(B=0)=>(K,$)=>IB(parseFloat,$)??B,kB=(B="")=>(K,$)=>$??B,bB=(B)=>(K,$)=>$!=null&&B.includes($.toLowerCase())?$:B[0],EB=(B)=>(K,$)=>{if(($??B)==null)throw new ReferenceError("Value and fallback are both null or undefined");if($==null)return B;if($==="")throw new SyntaxError("Empty string is not valid JSON");let W;try{W=JSON.parse($)}catch(Z){throw new SyntaxError(`Failed to parse JSON: ${String(Z)}`,{cause:Z})}return W??B};var XB=(B,K,$)=>O(B)?K.getSignal(B).get():P(B)?B.get():H(B)?B($):w,fB=(B)=>{if(/^(mailto|tel):/i.test(B))return!0;if(B.includes("://"))try{let K=new URL(B,window.location.origin);return["http:","https:","ftp:"].includes(K.protocol)}catch(K){return!1}return!0},mB=(B,K,$)=>{if(/^on/i.test(K))throw new Error(`Unsafe attribute: ${K}`);if($=String($).trim(),!fB($))throw new Error(`Unsafe URL for ${K}: ${$}`);B.setAttribute(K,$)},R=(B,K)=>($,W)=>{let{op:Z,name:J="",read:z,update:G}=K,Y=z(W),I={a:"attribute ",c:"class ",h:"inner HTML",p:"property ",s:"style property ",t:"text content"};if(O(B)&&O(Y)&&$[B]===w)$.attributeChangedCallback(B,null,Y);let X=(A)=>()=>{if(U&&$.debug)F(W,`${A} ${I[Z]+J} of ${Q(W)} in ${Q($)}`);K.resolve?.(W)},q=(A)=>(y)=>{F(y,`Failed to ${A} ${I[Z]+J} of ${Q(W)} in ${Q($)}`,E),K.reject?.(y)};return h(()=>{let A=Symbol(`${Z}:${J}`),y=Symbol(`${Z}-${J}`),L=w;try{L=XB(B,$,W)}catch(V){F(V,`Failed to resolve value of ${T(B)} for ${I[Z]+J} of ${Q(W)} in ${Q($)}`,E);return}if(L===w)L=Y;else if(L===j)L=K.delete?null:Y;if(K.delete&&L===null)N(()=>{return K.delete(W),!0},y).then(X("Deleted")).catch(q("delete"));else if(L!=null){let V=z(W);if(Object.is(L,V))return;N(()=>{return G(W,L),!0},A).then(X("Updated")).catch(q("update"))}})},dB=(B,K)=>($,W)=>{let Z=(z)=>()=>{if(U&&$.debug)F(W,`${z} element in ${Q(W)} in ${Q($)}`);if(H(K?.resolve))K.resolve(W);else{let G=P(B)?B:O(B)?$.getSignal(B):void 0;if(C(G))G.set(0)}},J=(z)=>(G)=>{F(G,`Failed to ${z} element in ${Q(W)} in ${Q($)}`,E),K?.reject?.(G)};return h(()=>{let z=Symbol("i"),G=Symbol("d"),Y=0;try{Y=XB(B,$,W)}catch(I){F(I,`Failed to resolve value of ${T(B)} for insertion or deletion in ${Q(W)} in ${Q($)}`,E);return}if(Y===w)Y=0;if(Y>0){if(!K)throw new TypeError("No inserter provided");N(()=>{for(let I=0;I<Y;I++){let X=K.create(W);if(!X)continue;W.insertAdjacentElement(K.position??"beforeend",X)}return!0},z).then(Z("Inserted")).catch(J("insert"))}else if(Y<0)N(()=>{if(K&&(K.position==="afterbegin"||K.position==="beforeend"))for(let I=0;I>Y;I--)if(K.position==="afterbegin")W.firstElementChild?.remove();else W.lastElementChild?.remove();else W.remove();return!0},G).then(Z("Removed")).catch(J("remove"))})},pB=(B)=>R(B,{op:"t",read:(K)=>K.textContent,update:(K,$)=>{Array.from(K.childNodes).filter((W)=>W.nodeType!==Node.COMMENT_NODE).forEach((W)=>W.remove()),K.append(document.createTextNode($))}}),hB=(B,K=B)=>R(K,{op:"p",name:String(B),read:($)=>(B in $)?$[B]:j,update:($,W)=>{$[B]=W}}),gB=(B,K=B)=>R(K,{op:"a",name:B,read:($)=>$.getAttribute(B),update:($,W)=>{mB($,B,W)},delete:($)=>{$.removeAttribute(B)}}),vB=(B,K=B)=>R(K,{op:"a",name:B,read:($)=>$.hasAttribute(B),update:($,W)=>{$.toggleAttribute(B,W)}}),cB=(B,K=B)=>R(K,{op:"c",name:B,read:($)=>$.classList.contains(B),update:($,W)=>{$.classList.toggle(B,W)}}),uB=(B,K=B)=>R(K,{op:"s",name:B,read:($)=>$.style.getPropertyValue(B),update:($,W)=>{$.style.setProperty(B,W)},delete:($)=>{$.style.removeProperty(B)}}),iB=(B,K,$)=>R(B,{op:"h",read:(W)=>(W.shadowRoot||!K?W:null)?.innerHTML??"",update:(W,Z)=>{if(!Z){if(W.shadowRoot)W.shadowRoot.innerHTML="<slot></slot>";return""}if(K&&!W.shadowRoot)W.attachShadow({mode:K});let J=W.shadowRoot||W;if(J.innerHTML=Z,!$)return"";return J.querySelectorAll("script").forEach((z)=>{let G=document.createElement("script");G.appendChild(document.createTextNode(z.textContent??"")),J.appendChild(G),z.remove()})," with scripts"}});export{R as updateElement,cB as toggleClass,vB as toggleAttribute,b as toSignal,i as state,pB as setText,uB as setStyle,hB as setProperty,gB as setAttribute,xB as selection,DB as provide,MB as pass,CB as on,F as log,C as isState,P as isSignal,k as isComputed,dB as insertOrRemoveElement,N as enqueue,UB as emit,h as effect,iB as dangerouslySetInnerHTML,NB as consume,o as computed,_B as component,ZB as batch,kB as asString,SB as asNumber,EB as asJSON,wB as asInteger,bB as asEnum,TB as asBoolean,j as UNSET,w as RESET,jB as LOG_WARN,QB as LOG_INFO,E as LOG_ERROR,HB as LOG_DEBUG};
