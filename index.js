var H=(B)=>typeof B==="function",v=(B,W)=>Object.prototype.toString.call(B)===`[object ${W}]`,m=(B)=>B instanceof Error?B:Error(String(B));class S extends Error{constructor(B){super(`Circular dependency in ${B} detected`);return this}}var _,c=new Set,s=0,l=new Map,i,ZB=()=>{i=void 0;let B=Array.from(l.values());l.clear();for(let W of B)W()},jB=()=>{if(i)cancelAnimationFrame(i);i=requestAnimationFrame(ZB)};queueMicrotask(ZB);var d=(B)=>{let W=new Set,$=B;return $.off=(Z)=>{W.add(Z)},$.cleanup=()=>{for(let Z of W)Z();W.clear()},$},D=(B)=>{if(_&&!B.has(_)){let W=_;B.add(W),_.off(()=>{B.delete(W)})}},M=(B)=>{for(let W of B)if(s)c.add(W);else W()},u=()=>{while(c.size){let B=Array.from(c);c.clear();for(let W of B)W()}},JB=(B)=>{s++;try{B()}finally{u(),s--}},h=(B,W)=>{let $=_;_=W;try{B()}finally{_=$}},N=(B,W)=>new Promise(($,Z)=>{l.set(W||Symbol(),()=>{try{$(B())}catch(J){Z(J)}}),jB()});var r="State",o=(B)=>{let W=new Set,$=B,Z={[Symbol.toStringTag]:r,get:()=>{return D(W),$},set:(J)=>{if(Object.is($,J))return;if($=J,M(W),Q===$)W.clear()},update:(J)=>{Z.set(J($))}};return Z},C=(B)=>v(B,r);var g="Computed",k=(B)=>{let W=new Set,$=Q,Z,J,K=!0,z=!1,G=!1,I=(V)=>{if(!Object.is(V,$))$=V,z=!0;Z=void 0,K=!1},X=()=>{z=Q!==$,$=Q,Z=void 0},Y=(V)=>{let q=m(V);z=!Z||q.name!==Z.name||q.message!==Z.message,$=Q,Z=q},x=(V)=>(q)=>{if(G=!1,J=void 0,V(q),z)M(W)},A=d(()=>{if(K=!0,J?.abort("Aborted because source signal changed"),W.size)M(W);else A.cleanup()}),R=()=>h(()=>{if(G)throw new S("computed");if(z=!1,H(B)&&B.constructor.name==="AsyncFunction"){if(J)return $;J=new AbortController,J.signal.addEventListener("abort",()=>{G=!1,J=void 0,R()},{once:!0})}let V;G=!0;try{V=J?B(J.signal):B()}catch(q){if(q instanceof DOMException&&q.name==="AbortError")X();else Y(q);G=!1;return}if(V instanceof Promise)V.then(x(I),x(Y));else if(V==null||Q===V)X();else I(V);G=!1},A);return{[Symbol.toStringTag]:g,get:()=>{if(D(W),u(),K)R();if(Z)throw Z;return $}}},E=(B)=>v(B,g),t=(B)=>H(B)&&B.length<2;var Q=Symbol(),O=(B)=>C(B)||E(B),b=(B)=>O(B)?B:t(B)?k(B):o(B);function p(B){let{signals:W,ok:$,err:Z=console.error,nil:J=()=>{}}=H(B)?{signals:[],ok:B}:B,K=!1,z=d(()=>h(()=>{if(K)throw new S("effect");K=!0;let G=[],I=!1,X=W.map((x)=>{try{let A=x.get();if(A===Q)I=!0;return A}catch(A){return G.push(m(A)),Q}}),Y=void 0;try{Y=I?J():G.length?Z(...G):$(...X)}catch(x){Y=Z(m(x))}finally{if(H(Y))z.off(Y)}K=!1},z));return z(),()=>z.cleanup()}var P=!1,QB="debug",VB="info",FB="warn",f="error",AB=(B)=>B?`#${B}`:"",LB=(B)=>B.length?`.${Array.from(B).join(".")}`:"",a=(B)=>!!B&&typeof B==="object",y=(B)=>typeof B==="string",KB=(B)=>B.nodeType===Node.ELEMENT_NODE,j=(B)=>`<${B.localName}${AB(B.id)}${LB(B.classList)}>`,w=(B)=>y(B)?`"${B}"`:a(B)?JSON.stringify(B):String(B),n=(B)=>{if(B===null)return"null";if(typeof B!=="object")return typeof B;if(Array.isArray(B))return"Array";if(Symbol.toStringTag in Object(B))return B[Symbol.toStringTag];return B.constructor?.name||"Object"},F=(B,W,$="debug")=>{if(["error","warn"].includes($))console[$](W,B);return B};class zB extends Error{constructor(B){super(B);this.name="CircularMutationError"}}var GB=(B)=>B instanceof HTMLElement&&B.localName.includes("-"),xB=(B)=>{let W=new Set;if(B.includes("."))W.add("class");if(B.includes("#"))W.add("id");if(B.includes("[")){let $=B.split("[");for(let Z=1;Z<$.length;Z++){let J=$[Z];if(!J.includes("]"))continue;let K=J.split("=")[0].trim().replace(/[^a-zA-Z0-9_-]/g,"");if(K)W.add(K)}}return[...W]},qB=(B,W)=>{if(B.length!==W.length)return!1;let $=new Set(B);for(let Z of W)if(!$.has(Z))return!1;return!0},e=(B,W,$)=>{let Z=new MutationObserver($),J=xB(W),K={childList:!0,subtree:!0};if(J.length)K.attributes=!0,K.attributeFilter=J;return Z.observe(B,K),Z},CB=(B,W)=>{let $=new Set,Z=()=>Array.from(B.querySelectorAll(W)),J=Q,K,z=0,G=2,I=()=>{J=Z(),K=e(B,W,()=>{if(!$.size){K?.disconnect(),K=void 0;return}if(z++,z>G)throw K?.disconnect(),K=void 0,z=0,new zB("Circular mutation in element selection detected");try{let Y=Z();if(!qB(J,Y))J=Y,M($)}finally{z--}})};return{[Symbol.toStringTag]:g,get:()=>{if(D($),!$.size)J=Z();else if(!K)I();return J}}},PB=(B,W)=>($,Z=$)=>{if(!H(W))throw new TypeError(`Invalid event listener provided for "${B} event on element ${j(Z)}`);return Z.addEventListener(B,W),()=>Z.removeEventListener(B,W)},UB=(B,W)=>($,Z=$)=>{Z.dispatchEvent(new CustomEvent(B,{detail:H(W)?W(Z):W,bubbles:!0}))},MB=(B)=>(W,$)=>{if(!GB($))throw new TypeError("Target element must be a custom element");let Z=H(B)?B($):B;if(!a(Z))throw new TypeError("Passed signals must be an object or a provider function");customElements.whenDefined($.localName).then(()=>{for(let[J,K]of Object.entries(Z)){let z=y(K)?W.getSignal(J):b(K);$.setSignal(J,z)}}).catch((J)=>{throw new Error(`Failed to pass signals to ${j($)}}`,{cause:J})})},OB=(B,W,$)=>{if(!B)return()=>$;if(!GB(B))throw new TypeError("Target element must be a custom element");let Z=k(async()=>{return await customElements.whenDefined(B.localName),B.getSignal(W)});return()=>{let J=Z.get();return J===Q?$:J.get()}};var T=Symbol(),yB=new Set(["constructor","prototype"]),RB=new Set(["id","class","className","title","role","style","dataset","lang","dir","hidden","children","innerHTML","outerHTML","textContent","innerText"]),BB=(B)=>H(B)&&B.length>=2,IB=(B)=>{if(yB.has(B))return`Property name "${B}" is a reserved word`;if(RB.has(B))return`Property name "${B}" conflicts with inherited HTMLElement property`;return null},$B=(B,W,$=W)=>{let Z=B.filter(H).map((J)=>J(W,$));return()=>{Z.filter(H).forEach((J)=>J()),Z.length=0}},_B=()=>({first:(B,...W)=>($)=>{let Z=($.shadowRoot||$).querySelector(B);if(Z)$B(W,$,Z)},all:(B,...W)=>($)=>{let Z=new Map,J=$.shadowRoot||$,K=(X)=>{if(!Z.has(X))Z.set(X,$B(W,$,X))},z=(X)=>{let Y=Z.get(X);if(H(Y))Y();Z.delete(X)},G=(X)=>(Y)=>{if(KB(Y)){if(Y.matches(B))X(Y);Y.querySelectorAll(B).forEach(X)}},I=e(J,B,(X)=>{for(let Y of X)Y.addedNodes.forEach(G(K)),Y.removedNodes.forEach(G(z))});return J.querySelectorAll(B).forEach(K),()=>{I.disconnect(),Z.forEach((X)=>X()),Z.clear()}}}),DB=(B,W={},$)=>{for(let J of Object.keys(W)){let K=IB(J);if(K)throw new TypeError(`${K} in component "${B}".`)}class Z extends HTMLElement{debug;#B={};#$;static observedAttributes=Object.entries(W)?.filter(([,J])=>BB(J)).map(([J])=>J)??[];constructor(){super();for(let[J,K]of Object.entries(W)){if(K==null)continue;let z=BB(K)?K(this,null):H(K)?K(this):K;if(z!=null)this.setSignal(J,b(z))}}connectedCallback(){if(P){if(this.debug=this.hasAttribute("debug"),this.debug)F(this,"Connected")}let J=$(this,_B());if(!Array.isArray(J))throw new TypeError(`Expected array of functions as return value of setup function in ${j(this)}`);this.#$=$B(J,this)}disconnectedCallback(){if(H(this.#$))this.#$();if(P&&this.debug)F(this,"Disconnected")}attributeChangedCallback(J,K,z){if(z===K||E(this.#B[J]))return;let G=W[J];if(!BB(G))return;let I=G(this,z,K);if(P&&this.debug)F(z,`Attribute "${J}" of ${j(this)} changed from ${w(K)} to ${w(z)}, parsed as <${n(I)}> ${w(I)}`);this[J]=I}getSignal(J){let K=this.#B[J];if(P&&this.debug)F(K,`Get ${n(K)} "${String(J)}" in ${j(this)}`);return K}setSignal(J,K){let z=IB(String(J));if(z)throw new TypeError(`${z} on ${j(this)}.`);if(!O(K))throw new TypeError(`Expected signal as value for property "${String(J)}" on ${j(this)}.`);let G=this.#B[J],I=C(K);if(this.#B[J]=K,Object.defineProperty(this,J,{get:K.get,set:I?K.set:void 0,enumerable:!0,configurable:I}),G&&C(G))G.set(Q);if(P&&this.debug)F(K,`Set ${n(K)} "${String(J)} in ${j(this)}`)}}return customElements.define(B,Z),Z};var WB="context-request";class XB extends Event{B;W;$;constructor(B,W,$=!1){super(WB,{bubbles:!0,composed:!0});this.context=B;this.callback=W;this.subscribe=$}}var NB=(B)=>(W)=>{let $=(Z)=>{let{context:J,callback:K}=Z;if(B.includes(J)&&H(K))Z.stopPropagation(),K(W.getSignal(String(J)))};return W.addEventListener(WB,$),()=>W.removeEventListener(WB,$)},wB=(B)=>(W)=>{let $;return W.dispatchEvent(new XB(B,(Z)=>{$=Z})),$};var YB=(B,W)=>{if(W==null)return;let $=B(W);return Number.isFinite($)?$:void 0},TB=(B,W)=>W!=="false"&&W!=null,SB=(B=0)=>(W,$)=>{if($==null)return B;let Z=$.trim();if(Z==="")return B;if(Z.toLowerCase().startsWith("0x")){let K=parseInt(Z,16);return Number.isFinite(K)?K:B}let J=YB(parseFloat,$);return J!=null?Math.trunc(J):B},kB=(B=0)=>(W,$)=>YB(parseFloat,$)??B,EB=(B="")=>(W,$)=>$??B,bB=(B)=>(W,$)=>{if($==null)return B[0];let Z=$.toLowerCase();return B.find((K)=>K.toLowerCase()===Z)?$:B[0]},fB=(B)=>(W,$)=>{if(($??B)==null)throw new ReferenceError("Value and fallback are both null or undefined");if($==null)return B;if($==="")throw new SyntaxError("Empty string is not valid JSON");let Z;try{Z=JSON.parse($)}catch(J){throw new SyntaxError(`Failed to parse JSON: ${String(J)}`,{cause:J})}return Z??B};var HB=(B,W,$)=>y(B)?W.getSignal(B).get():O(B)?B.get():H(B)?B($):T,mB=(B)=>{if(/^(mailto|tel):/i.test(B))return!0;if(B.includes("://"))try{let W=new URL(B,window.location.origin);return["http:","https:","ftp:"].includes(W.protocol)}catch(W){return!1}return!0},dB=(B,W,$)=>{if(/^on/i.test(W))throw new Error(`Unsafe attribute: ${W}`);if($=String($).trim(),!mB($))throw new Error(`Unsafe URL for ${W}: ${$}`);B.setAttribute(W,$)},U=(B,W)=>($,Z)=>{let{op:J,name:K="",read:z,update:G}=W,I=z(Z),X={a:"attribute ",c:"class ",h:"inner HTML",p:"property ",s:"style property ",t:"text content"};if(y(B)&&y(I)&&$[B]===T)$.attributeChangedCallback(B,null,I);let Y=(A)=>()=>{if(P&&$.debug)F(Z,`${A} ${X[J]+K} of ${j(Z)} in ${j($)}`);W.resolve?.(Z)},x=(A)=>(R)=>{F(R,`Failed to ${A} ${X[J]+K} of ${j(Z)} in ${j($)}`,f),W.reject?.(R)};return p(()=>{let A=Symbol(`${J}:${K}`),R=Symbol(`${J}-${K}`),L=T;try{L=HB(B,$,Z)}catch(V){F(V,`Failed to resolve value of ${w(B)} for ${X[J]+K} of ${j(Z)} in ${j($)}`,f);return}if(L===T)L=I;else if(L===Q)L=W.delete?null:I;if(W.delete&&L===null)N(()=>{return W.delete(Z),!0},R).then(Y("Deleted")).catch(x("delete"));else if(L!=null){let V=z(Z);if(Object.is(L,V))return;N(()=>{return G(Z,L),!0},A).then(Y("Updated")).catch(x("update"))}})},hB=(B,W)=>($,Z)=>{let J=(z)=>()=>{if(P&&$.debug)F(Z,`${z} element in ${j(Z)} in ${j($)}`);if(H(W?.resolve))W.resolve(Z);else{let G=O(B)?B:y(B)?$.getSignal(B):void 0;if(C(G))G.set(0)}},K=(z)=>(G)=>{F(G,`Failed to ${z} element in ${j(Z)} in ${j($)}`,f),W?.reject?.(G)};return p(()=>{let z=Symbol("i"),G=Symbol("d"),I=0;try{I=HB(B,$,Z)}catch(X){F(X,`Failed to resolve value of ${w(B)} for insertion or deletion in ${j(Z)} in ${j($)}`,f);return}if(I===T)I=0;if(I>0){if(!W)throw new TypeError("No inserter provided");N(()=>{for(let X=0;X<I;X++){let Y=W.create(Z);if(!Y)continue;Z.insertAdjacentElement(W.position??"beforeend",Y)}return!0},z).then(J("Inserted")).catch(K("insert"))}else if(I<0)N(()=>{if(W&&(W.position==="afterbegin"||W.position==="beforeend"))for(let X=0;X>I;X--)if(W.position==="afterbegin")Z.firstElementChild?.remove();else Z.lastElementChild?.remove();else Z.remove();return!0},G).then(J("Removed")).catch(K("remove"))})},gB=(B)=>U(B,{op:"t",read:(W)=>W.textContent,update:(W,$)=>{Array.from(W.childNodes).filter((Z)=>Z.nodeType!==Node.COMMENT_NODE).forEach((Z)=>Z.remove()),W.append(document.createTextNode($))}}),pB=(B,W=B)=>U(W,{op:"p",name:String(B),read:($)=>(B in $)?$[B]:Q,update:($,Z)=>{$[B]=Z}}),vB=(B)=>U(B,{op:"p",name:"hidden",read:(W)=>!W.hidden,update:(W,$)=>{W.hidden=!$}}),cB=(B,W=B)=>U(W,{op:"a",name:B,read:($)=>$.getAttribute(B),update:($,Z)=>{dB($,B,Z)},delete:($)=>{$.removeAttribute(B)}}),iB=(B,W=B)=>U(W,{op:"a",name:B,read:($)=>$.hasAttribute(B),update:($,Z)=>{$.toggleAttribute(B,Z)}}),uB=(B,W=B)=>U(W,{op:"c",name:B,read:($)=>$.classList.contains(B),update:($,Z)=>{$.classList.toggle(B,Z)}}),oB=(B,W=B)=>U(W,{op:"s",name:B,read:($)=>$.style.getPropertyValue(B),update:($,Z)=>{$.style.setProperty(B,Z)},delete:($)=>{$.style.removeProperty(B)}}),nB=(B,W={})=>U(B,{op:"h",read:($)=>($.shadowRoot||!W.shadowRootMode?$:null)?.innerHTML??"",update:($,Z)=>{let{shadowRootMode:J,allowScripts:K}=W;if(!Z){if($.shadowRoot)$.shadowRoot.innerHTML="<slot></slot>";return""}if(J&&!$.shadowRoot)$.attachShadow({mode:J});let z=$.shadowRoot||$;if(z.innerHTML=Z,!K)return"";return z.querySelectorAll("script").forEach((G)=>{let I=document.createElement("script");I.appendChild(document.createTextNode(G.textContent??"")),z.appendChild(I),G.remove()})," with scripts"}});export{U as updateElement,uB as toggleClass,iB as toggleAttribute,b as toSignal,o as state,vB as show,gB as setText,oB as setStyle,pB as setProperty,cB as setAttribute,CB as selection,OB as read,NB as provide,MB as pass,PB as on,F as log,C as isState,O as isSignal,E as isComputed,hB as insertOrRemoveElement,N as enqueue,UB as emit,p as effect,nB as dangerouslySetInnerHTML,wB as consume,k as computed,DB as component,JB as batch,EB as asString,kB as asNumber,fB as asJSON,SB as asInteger,bB as asEnum,TB as asBoolean,Q as UNSET,T as RESET,FB as LOG_WARN,VB as LOG_INFO,f as LOG_ERROR,QB as LOG_DEBUG};
