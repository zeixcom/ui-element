var P=($)=>typeof $==="function",z$=($)=>P($)&&$.constructor.name==="AsyncFunction",h=($,K)=>Object.prototype.toString.call($)===`[object ${K}]`,U$=($)=>$ instanceof Error,d=($)=>$ instanceof DOMException&&$.name==="AbortError",I$=($)=>$ instanceof Promise,D=($)=>U$($)?$:Error(String($));class S extends Error{constructor($){super(`Circular dependency in ${$} detected`);return this}}var _,v=new Set,t=0,e=new Map,c,X$=()=>{c=void 0;let $=Array.from(e.values());e.clear();for(let K of $)K()},L$=()=>{if(c)cancelAnimationFrame(c);c=requestAnimationFrame(X$)};queueMicrotask(X$);var i=($)=>{if(_&&!$.has(_)){let K=_;$.add(K),_.cleanups.add(()=>{$.delete(K)})}},b=($)=>{for(let K of $)if(t)v.add(K);else K()},$$=()=>{while(v.size){let $=Array.from(v);v.clear();for(let K of $)K()}},Y$=($)=>{t++;try{$()}finally{$$(),t--}},k=($,K)=>{let B=_;_=K;try{$()}finally{_=B}},O=($,K=[])=>new Promise((B,W)=>{e.set(K,()=>{try{B($())}catch(Z){W(Z)}}),L$()});function q($){let{signals:K,ok:B,err:W=console.error,nil:Z=()=>{}}=P($)?{signals:[],ok:$}:$,H=!1,J=()=>k(()=>{if(H)throw new S("effect");H=!0;let z=void 0;try{z=o({signals:K,ok:B,err:W,nil:Z})}catch(Y){W(D(Y))}if(P(z))J.cleanups.add(z);H=!1},J);return J.cleanups=new Set,J(),()=>{J.cleanups.forEach((z)=>z()),J.cleanups.clear()}}var Q$="Computed",y$=($,K)=>{if(!K)return!1;return $.name===K.name&&$.message===K.message},T=($)=>{let K=new Set,B=P($)?void 0:{nil:()=>A,err:(...X)=>{if(X.length>1)throw new AggregateError(X);else throw X[0]},...$},W=B?B.ok:$,Z=A,H,J=!0,z=!1,Y=!1,Q,I=(X)=>{if(!Object.is(X,Z))Z=X,J=!1,H=void 0,z=!0},F=()=>{z=A!==Z,Z=A,H=void 0},M=(X)=>{let p=D(X);z=!y$(p,H),Z=A,H=p},r=(X)=>{if(Y=!1,Q=void 0,I(X),z)b(K)},M$=(X)=>{if(Y=!1,Q=void 0,M(X),z)b(K)},q$=()=>{Y=!1,Q=void 0,J$()},g=()=>{if(J=!0,Q?.abort("Aborted because source signal changed"),K.size){if(z)b(K)}else g.cleanups.forEach((X)=>X()),g.cleanups.clear()};g.cleanups=new Set;let J$=()=>k(()=>{if(Y)throw new S("computed");if(z=!1,z$(W)){if(Q)return Z;if(Q=new AbortController,B)B.abort=B.abort instanceof AbortSignal?AbortSignal.any([B.abort,Q.signal]):Q.signal;Q.signal.addEventListener("abort",q$,{once:!0})}let X;Y=!0;try{X=B&&B.signals.length?o(B):W(Q?.signal)}catch(p){d(p)?F():M(p),Y=!1;return}if(I$(X))X.then(r,M$);else if(X==null||A===X)F();else I(X);Y=!1},g),a={[Symbol.toStringTag]:Q$,get:()=>{if(i(K),$$(),J)J$();if(H)throw H;return Z},map:(X)=>T({signals:[a],ok:X}),tap:(X)=>q({signals:[a],...P(X)?{ok:X}:X})};return a},E=($)=>h($,Q$);var j$="State",u=($)=>{let K=new Set,B=$,W={[Symbol.toStringTag]:j$,get:()=>{return i(K),B},set:(Z)=>{if(Object.is(B,Z))return;if(B=Z,b(K),A===B)K.clear()},update:(Z)=>{W.set(Z(B))},map:(Z)=>T({signals:[W],ok:Z}),tap:(Z)=>q({signals:[W],...P(Z)?{ok:Z}:Z})};return W},U=($)=>h($,j$);var A=Symbol(),R=($)=>U($)||E($),A$=($)=>P($)&&$.length<2,f=($)=>R($)?$:A$($)?T($):u($),o=($)=>{let{signals:K,abort:B,ok:W,err:Z,nil:H}=$,J=[],z=!1,Y=K.map((Q)=>{try{let I=Q.get();if(I===A)z=!0;return I}catch(I){if(d(I))throw I;J.push(D(I))}});try{return z?H(B):J.length?Z(...J):W(...Y)}catch(Q){if(d(Q))throw Q;let I=D(Q);return Z(I)}};var C=($)=>typeof $==="function",m=($)=>!!$&&typeof $==="object",L=($)=>typeof $==="string";var V=!1,G$="debug",x$="info",C$="warn",y="error",D$=($)=>$?`#${$}`:"",_$=($)=>$.length?`.${Array.from($).join(".")}`:"",j=($)=>`<${$.localName}${D$($.id)}${_$($.classList)}>`,n=($)=>L($)?`"${$}"`:m($)?JSON.stringify($):String($),s=($)=>{if($===null)return"null";if(typeof $!=="object")return typeof $;if(Array.isArray($))return"Array";if(Symbol.toStringTag in Object($))return $[Symbol.toStringTag];return $.constructor?.name||"Object"},G=($,K,B=G$)=>{if(V||[y,C$].includes(B))console[B](K,$);return $};var B$=($)=>C($)&&$.length==2,O$=($)=>C($)||m($)&&C($.handleEvent),T$=($)=>$ instanceof HTMLElement&&$.localName.includes("-"),N=($,K,B,W)=>$.flatMap((Z)=>{let H=C(Z)?Z(K,B??K,W):[];return Array.isArray(H)?H.filter(C):C(H)?[H]:[]}),R$=($,...K)=>(B)=>{let W=(B.shadowRoot||B).querySelector($);return W?N(K,B,W):[]},N$=($,...K)=>(B)=>Array.from((B.shadowRoot||B).querySelectorAll($)).flatMap((W,Z)=>N(K,B,W,Z)),w$=($,K)=>(B,W=B,Z=0)=>{let H=B$(K)?K(W,Z):K;if(!O$(H))throw new TypeError(`Invalid event listener provided for "${$} event on element ${j(W)}`);return W.addEventListener($,H),()=>W.removeEventListener($,H)},S$=($,K)=>(B,W=B,Z=0)=>{W.dispatchEvent(new CustomEvent($,{detail:B$(K)?K(W,Z):K,bubbles:!0}))},b$=($)=>(K,B,W=0)=>{let Z=B.localName;if(!T$(B))throw new TypeError("Target element must be a custom element");let H=B$($)?$(B,W):$;if(!m(H))throw new TypeError("Passed signals must be an object or a provider function");customElements.whenDefined(Z).then(()=>{for(let[J,z]of Object.entries(H)){let Y=L(z)?K.getSignal(J):f(z);B.setSignal(J,Y)}}).catch((J)=>{throw new Error(`Failed to pass signals to ${j(B)}}`,{cause:J})})};var w=Symbol(),k$=new Set(Object.getOwnPropertyNames(HTMLElement.prototype)),E$=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString"]),K$=($)=>C($)&&$.length>=2,f$=($)=>C($)&&$.length<2,p$=($)=>!(k$.has($)||E$.has($)),d$=($,K={},B)=>{class W extends HTMLElement{debug;#B={};#$=[];static observedAttributes=Object.entries(K)?.filter(([,Z])=>K$(Z)).map(([Z])=>Z)??[];constructor(){super();for(let[Z,H]of Object.entries(K)){if(H==null)continue;let J=K$(H)?H(this,null):f$(H)?H(this):H;this.setSignal(Z,f(J??w))}}connectedCallback(){if(V){if(this.debug=this.hasAttribute("debug"),this.debug)G(this,"Connected")}let Z=B(this);if(!Array.isArray(Z))throw new TypeError(`Expected array of functions as return value of setup() in ${j(this)}`);this.#$=N(Z,this)}disconnectedCallback(){for(let Z of this.#$)Z();if(this.#$.length=0,V&&this.debug)G(this,"Disconnected")}attributeChangedCallback(Z,H,J){if(J===H||E(this.#B[Z]))return;let z=K[Z];if(!K$(z))return;let Y=z(this,J,H);if(V&&this.debug)G(J,`Attribute "${Z}" of ${j(this)} changed from ${n(H)} to ${n(J)}, parsed as <${s(Y)}> ${n(Y)}`);this[Z]=Y}getSignal(Z){let H=this.#B[Z];if(V&&this.debug)G(H,`Get ${s(H)} "${Z}" in ${j(this)}`);return H}setSignal(Z,H){if(!p$(Z))throw new TypeError(`Invalid property name "${Z}". Property names must be valid JavaScript identifiers and not conflict with inherited HTMLElement properties.`);if(!R(H))throw new TypeError(`Expected signal as value for property "${Z}" on ${j(this)}.`);let J=this.#B[Z],z=U(H);if(this.#B[Z]=H,Object.defineProperty(this,Z,{get:H.get,set:z?H.set:void 0,enumerable:!0,configurable:z}),J&&U(J))J.set(A);if(V&&this.debug)G(H,`Set ${s(H)} "${Z} in ${j(this)}`)}self(...Z){this.#$.push(...N(Z,this,this))}first(Z,...H){let J=(this.shadowRoot||this).querySelector(Z);if(J)this.#$.push(...N(H,this,J))}all(Z,...H){this.#$.push(...Array.from((this.shadowRoot||this).querySelectorAll(Z)).flatMap((J,z)=>N(H,this,J,z)))}}return customElements.define($,W),W};var Z$="context-request";class F$ extends Event{$;K;B;constructor($,K,B=!1){super(Z$,{bubbles:!0,composed:!0});this.context=$;this.callback=K;this.subscribe=B}}var m$=($)=>(K)=>{let B=(W)=>{let{context:Z,callback:H}=W;if($.includes(Z)&&C(H))W.stopPropagation(),H(K.getSignal(String(Z)))};return K.addEventListener(Z$,B),()=>K.removeEventListener(Z$,B)},g$=($)=>(K)=>{let B;return K.dispatchEvent(new F$($,(W)=>{B=W})),B};var V$=($,K)=>{if(K==null)return;let B=$(K);return Number.isFinite(B)?B:void 0},h$=($,K)=>K!=="false"&&K!=null,v$=($=0)=>(K,B)=>V$(parseInt,B)??$,c$=($=0)=>(K,B)=>V$(parseFloat,B)??$,i$=($="")=>(K,B)=>B??$,o$=($)=>(K,B)=>B!=null&&$.includes(B.toLowerCase())?B:$[0],u$=($)=>(K,B)=>{if((B??$)==null)throw new ReferenceError("Value and fallback are both null or undefined");if(B==null)return $;if(B==="")throw new SyntaxError("Empty string is not valid JSON");let W;try{W=JSON.parse(B)}catch(Z){throw new SyntaxError(`Failed to parse JSON: ${String(Z)}`,{cause:Z})}return W??$};var l={a:"attribute ",c:"class ",h:"inner HTML",p:"property ",s:"style property ",t:"text content"},W$=($,K,B,W)=>L($)?K.getSignal($).get():R($)?$.get():C($)?$(B,W):w,n$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let K=new URL($,window.location.origin);return["http:","https:","ftp:"].includes(K.protocol)}catch(K){return!1}return!0},P$=($,K,B)=>{if(/^on/i.test(K))throw new Error(`Unsafe attribute: ${K}`);if(B=String(B).trim(),!n$(B))throw new Error(`Unsafe URL for ${K}: ${B}`);$.setAttribute(K,B)},x=($,K)=>(B,W,Z=0)=>{let{op:H,read:J,update:z}=K,Y=J(W);if(L($)&&L(Y)&&B[$]===w)B.attributeChangedCallback($,null,Y);let Q=(I,F,M="element")=>G(I,`Failed to ${F} ${M} ${j(W)} in ${j(B)}`,y);return q(()=>{let I=w;try{I=W$($,B,W,Z)}catch(F){Q(F,"update");return}if(I===w)I=Y;if(I===A)I=K.delete?null:Y;if(K.delete&&I===null){let F="";O(()=>{return F=K.delete(W),!0},[W,H]).then(()=>{if(V&&B.debug)G(W,`Deleted ${l[H]+F} of ${j(W)} in ${j(B)}`)}).catch((M)=>{Q(M,"delete",`${l[H]+F} of`)})}else if(I!=null){let F=J(W);if(Object.is(I,F))return;let M="";O(()=>{return M=z(W,I),!0},[W,H]).then(()=>{if(V&&B.debug)G(W,`Updated ${l[H]+M} of ${j(W)} in ${j(B)}`)}).catch((r)=>{Q(r,"update",`${l[H]+M} of`)})}})},H$=($,{type:K,where:B,create:W})=>(Z,H,J=0)=>{let z={beforebegin:"before",afterbegin:"prepend",beforeend:"append",afterend:"after"};if(!C(H[z[B]])){G(`Invalid insertPosition "${B}" for ${j(Z)}:`,y);return}let Y=(Q)=>G(Q,`Failed to insert ${K} into ${j(Z)}:`,y);return q(()=>{let Q=!1;try{Q=W$($,Z,H,J)}catch(I){Y(I);return}if(!Q)return;O(()=>{let I=W(Z);if(!I)return;H[z[B]](I)},[H,"i"]).then(()=>{if(L($)&&Object.getOwnPropertyDescriptor(Z,$)?.set)Z[$]=!1;if(U($))$.set(!1);if(V&&Z.debug)G(H,`Inserted ${K} into ${j(Z)}`)}).catch((I)=>{Y(I)})})},s$=($)=>x($,{op:"t",read:(K)=>K.textContent,update:(K,B)=>{return Array.from(K.childNodes).filter((W)=>W.nodeType!==Node.COMMENT_NODE).forEach((W)=>W.remove()),K.append(document.createTextNode(B)),""}}),l$=($,K=$)=>x(K,{op:"p",read:(B)=>($ in B)?B[$]:A,update:(B,W)=>{return B[$]=W,String($)}}),r$=($,K=$)=>x(K,{op:"a",read:(B)=>B.getAttribute($),update:(B,W)=>{return P$(B,$,W),$},delete:(B)=>{return B.removeAttribute($),$}}),a$=($,K=$)=>x(K,{op:"a",read:(B)=>B.hasAttribute($),update:(B,W)=>{return B.toggleAttribute($,W),$}}),t$=($,K=$)=>x(K,{op:"c",read:(B)=>B.classList.contains($),update:(B,W)=>{return B.classList.toggle($,W),$}}),e$=($,K=$)=>x(K,{op:"s",read:(B)=>B.style.getPropertyValue($),update:(B,W)=>{return B.style.setProperty($,W),$},delete:(B)=>{return B.style.removeProperty($),$}}),$B=($,K,B)=>x($,{op:"h",read:(W)=>(W.shadowRoot||!K?W:null)?.innerHTML??"",update:(W,Z)=>{if(!Z){if(W.shadowRoot)W.shadowRoot.innerHTML="<slot></slot>";return""}if(K&&!W.shadowRoot)W.attachShadow({mode:K});let H=W.shadowRoot||W;if(H.innerHTML=Z,!B)return"";return H.querySelectorAll("script").forEach((J)=>{let z=document.createElement("script");z.appendChild(document.createTextNode(J.textContent??"")),H.appendChild(z),J.remove()})," with scripts"}}),BB=($,K,B="beforeend")=>H$(K,{type:"template content",where:B,create:(W)=>{if(!($ instanceof HTMLTemplateElement)){G(`Invalid template to insert into ${j(W)}:`,y);return}return W.shadowRoot?document.importNode($.content,!0):$.content.cloneNode(!0)}}),KB=($,K,B="beforeend",W={},Z)=>H$(K,{type:"new element",where:B,create:()=>{let H=document.createElement($);for(let[J,z]of Object.entries(W))P$(H,J,z);if(Z)H.textContent=Z;return H}}),ZB=($)=>(K,B,W=0)=>{let Z=(H)=>G(H,`Failed to delete ${j(B)} from ${j(K)}:`,y);return q(()=>{let H=!1;try{H=W$($,K,B,W)}catch(J){Z(J);return}if(!H)return;O(()=>{return B.remove(),!0},[B,"r"]).then(()=>{if(V&&K.debug)G(B,`Deleted ${j(B)} into ${j(K)}`)}).catch((J)=>{Z(J)})})};export{k as watch,x as updateElement,t$ as toggleClass,a$ as toggleAttribute,f as toSignal,u as state,s$ as setText,e$ as setStyle,l$ as setProperty,r$ as setAttribute,ZB as removeElement,m$ as provide,b$ as pass,w$ as on,G as log,U as isState,R as isSignal,E as isComputed,BB as insertTemplate,H$ as insertNode,R$ as first,O as enqueue,S$ as emit,q as effect,$B as dangerouslySetInnerHTML,KB as createElement,g$ as consume,T as computed,d$ as component,Y$ as batch,i$ as asString,c$ as asNumber,u$ as asJSON,v$ as asInteger,o$ as asEnum,h$ as asBoolean,N$ as all,A as UNSET,w as RESET,C$ as LOG_WARN,x$ as LOG_INFO,y as LOG_ERROR,G$ as LOG_DEBUG};
