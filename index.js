var r=($)=>typeof $==="function",l=($)=>r($)&&/^async\s+/.test($.toString()),t=($)=>r($)&&$.length<2,a=($)=>(K)=>K instanceof $,m=a(Error),e=a(Promise);var $$="Computed",T=($,K)=>{K=K??l($);let Z=[],Y,Q=null,X=!0,H=()=>{if(X=!0,K)O(Z)},A={[Symbol.toStringTag]:$$,get:()=>{if(K)b(Z);if(!K||X)k(()=>{let j=(V)=>{Y=V,X=!1,Q=null},s=(V)=>{Q=m(V)?V:new Error(`Computed function failed: ${V}`)};try{let V=$(Y);e(V)?V.then(j).catch(s):j(V)}catch(V){s(V)}},H);if(m(Q))throw Q;return Y},map:(j)=>T(()=>j(A.get()))};return A},P=($)=>!!$&&typeof $==="object"&&$[Symbol.toStringTag]===$$;var D,o=!1,i=[],C=($)=>N($)||P($),R=($,K=!1)=>C($)?$:t($)?T($,K):E($),b=($)=>{if(D&&!$.includes(D))$.push(D)},O=($)=>$.forEach((K)=>o?i.push(K):K()),k=($,K)=>{let Z=D;D=K,$(),D=Z},K$=($)=>{o=!0,$(),o=!1,i.forEach((K)=>K()),i.length=0};var U=Symbol();class h{$;watchers=[];constructor($){this.value=$}get(){return b(this.watchers),this.value}set($){if(Object.is(this.value,$))return;if(this.value=$,O(this.watchers),U===$)this.watchers=[]}update($){this.set($(this.value))}map($){return T(()=>$(this.get()))}}var E=($)=>new h($),N=($)=>$ instanceof h;var y=($)=>{let K=()=>k(()=>{try{$()}catch(Z){console.error(Z)}},K);K()};if(!("requestAnimationFrame"in globalThis))globalThis.requestAnimationFrame=($)=>setTimeout($,16);var p=new Map,f=[],g,Z$=()=>{g=null,f.forEach(($)=>$()),f=[],p.clear()},G$=()=>{if(g)cancelAnimationFrame(g);g=requestAnimationFrame(Z$)};queueMicrotask(Z$);var w=($,K)=>new Promise((Z,Y)=>{let Q=()=>{try{Z($())}catch(X){Y(X)}};if(K){let[X,H]=K;if(!p.has(X))p.set(X,new Map);let A=p.get(X);if(A.has(H)){let j=f.indexOf($);if(j>-1)f.splice(j,1)}A.set(H,Q)}f.push(Q),G$()}),Y$=async()=>new Promise(requestAnimationFrame);var Q$=($)=>$.nodeType===Node.COMMENT_NODE,N$=($)=>!/^on/i.test($),x$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let K=new URL($,window.location.origin);return!["http:","https:","ftp:"].includes(K.protocol)}catch(K){return!0}return!0},v=($,K,Z)=>{if(!N$(K))throw new Error(`Unsafe attribute: ${K}`);if(Z=String(Z).trim(),!x$(Z))throw new Error(`Unsafe URL for ${K}: ${Z}`);$.setAttribute(K,Z)};var X$=($,K,Z={},Y)=>w(()=>{let Q=document.createElement(K);for(let[X,H]of Object.entries(Z))v(Q,X,H);if(Y)Q.textContent=Y;return $.append(Q),Q},[$,"e"]),B$=($)=>w(()=>{return $.remove(),null},[$,"r"]),H$=($,K)=>w(()=>{return Array.from($.childNodes).filter((Z)=>!Q$(Z)).forEach((Z)=>Z.remove()),$.append(document.createTextNode(K)),$},[$,"t"]),J$=($,K,Z)=>w(()=>{return v($,K,Z),$},[$,`a:${K}`]),j$=($,K)=>w(()=>{return $.removeAttribute(K),$},[$,`a:${K}`]),z$=($,K,Z)=>w(()=>{return $.toggleAttribute(K,Z),$},[$,`a:${K}`]),w$=($,K,Z)=>w(()=>{return $.classList.toggle(K,Z),$},[$,`c:${K}`]),A$=($,K,Z)=>w(()=>{return $.style.setProperty(K,Z),$},[$,`s:${K}`]),V$=($,K)=>w(()=>{return $.style.removeProperty(K),$},[$,`s:${K}`]);var J=($)=>typeof $==="function",S=($)=>!!$&&typeof $==="object",q=($)=>typeof $==="string";var z=!1,d="debug",L$="info",x="warn",I="error",P$=($)=>$?`#${$}`:"",D$=($)=>$.length?`.${Array.from($).join(".")}`:"",F=($)=>`<${$.localName}${P$($.id)}${D$($.classList)}>`,W=($)=>q($)?`"${$}"`:S($)?JSON.stringify($):String($),B=($,K,Z=d)=>{if(z||[I,x].includes(Z))console[Z](K,$);return $};class _{$;K;constructor($,K=[$]){this.host=$;this.targets=K}on($,K){return this.targets.forEach((Z,Y)=>{let Q;if(J(K))Q=K.length===2?K(Z,Y):K;else if(S(K)&&J(K.handleEvent))Q=K;else{B(K,`Invalid listener provided for ${$} event on element ${F(Z)}`,I);return}Z.addEventListener($,Q),this.host.cleanup.push(()=>Z.removeEventListener($,Q))}),this}emit($,K){return this.targets.forEach((Z)=>{Z.dispatchEvent(new CustomEvent($,{detail:K,bubbles:!0}))}),this}pass($){return this.targets.forEach(async(K,Z)=>{if(await L.registry.whenDefined(K.localName),K instanceof L){let Y;if(J($)&&$.length===2)Y=$(K,Z);else if(S($))Y=$;else{B($,"Invalid passed signals provided",I);return}Object.entries(Y).forEach(([Q,X])=>{if(q(X))if(X in this.host.signals)K.set(Q,this.host.signals[X]);else B(X,`Invalid string key "${X}" for state ${W(Q)}`,x);else if(J(X)||C(X))K.set(Q,R(X,!0));else B(X,`Invalid source for state ${W(Q)}`,x)})}else B(K,"Target is not a UIElement",I)}),this}sync(...$){return this.targets.forEach((K,Z)=>$.forEach((Y)=>Y(this.host,K,Z))),this}}var C$="context-request";class F$ extends Event{$;K;Z;constructor($,K,Z=!1){super(C$,{bubbles:!0,composed:!0});this.context=$;this.callback=K;this.subscribe=Z}}var n=($)=>{let K=$.constructor,Z=K.consumedContexts||[];queueMicrotask(()=>{for(let Q of Z)$.dispatchEvent(new F$(Q,(X)=>$.set(String(Q),X??G)))});let Y=K.providedContexts||[];if(!Y.length)return!1;return $.addEventListener(C$,(Q)=>{let{context:X,callback:H}=Q;if(!Y.includes(X)||!J(H))return;Q.stopPropagation(),H($.signals[String(X)])}),!0};var G=Symbol(),W$=($)=>J($)&&!!$.length,R$=($)=>J($)&&!$.length,u=($)=>J($)?u($()):C($)?u($.get()):$,c=($,K,Z,Y)=>{let Q=$.states[K];return W$(Q)?Q(Z,$,Y):Z};class L extends HTMLElement{static registry=customElements;static localName;static observedAttributes;static consumedContexts;static providedContexts;static define($=this.localName){try{if(this.registry.define($,this),z)B($,"Registered custom element")}catch(K){B(K,`Failed to register custom element ${$}`,I)}return this}states={};signals={};cleanup=[];self=new _(this);get root(){return this.shadowRoot||this}debug=!1;attributeChangedCallback($,K,Z){if(Z===K||P(this.signals[$]))return;let Y=c(this,$,Z,K);if(z&&this.debug)B(Z,`Attribute "${$}" of ${F(this)} changed from ${W(K)} to ${W(Z)}, parsed as <${typeof Y}> ${W(Y)}`);this.set($,Y??G)}connectedCallback(){if(z){if(this.debug=this.hasAttribute("debug"),this.debug)B(this,"Connected")}for(let[$,K]of Object.entries(this.states)){let Z=W$(K)?K(this.getAttribute($),this):R$(K)?T(K,!0):K;this.set($,Z??G)}n(this)}disconnectedCallback(){if(this.cleanup.forEach(($)=>$()),this.cleanup=[],z&&this.debug)B(this,"Disconnected")}adoptedCallback(){if(z&&this.debug)B(this,"Adopted")}has($){return $ in this.signals}get($){let K=u(this.signals[$]);if(z&&this.debug)B(K,`Get current value of state <${typeof K}> ${W($)} in ${F(this)}`);return K}set($,K,Z=!0){let Y,Q=this.signals[$],X=Q?.get();if(!($ in this.signals)){if(z&&this.debug)Y="Create";this.signals[$]=R(K,!0)}else if(Z||X===U||X===G)if(C(K)){if(z&&this.debug)Y="Replace";if(this.signals[$]=K,N(Q))Q.set(U)}else if(N(Q)){if(z&&this.debug)Y="Update";if(J(K))Q.update(K);else Q.set(K)}else{B(K,`Computed state ${W($)} in ${F(this)} cannot be set`,x);return}else return;if(z&&this.debug)B(K,`${Y} state <${typeof K}> ${W($)} in ${F(this)}`)}delete($){if(z&&this.debug)B($,`Delete state ${W($)} from ${F(this)}`);return delete this.signals[$]}first($){let K=this.root.querySelector($);return new _(this,K?[K]:[])}all($){return new _(this,Array.from(this.root.querySelectorAll($)))}}var I$=($,K)=>{if(K==null)return;let Z=$(K);return Number.isFinite(Z)?Z:void 0},_$=($)=>Array.isArray($)&&$[0]?$[0]:$,y$=($)=>$!=="false"&&$!=null,T$=($=0)=>(K)=>I$(parseInt,K)??$,f$=T$(),U$=($=0)=>(K)=>I$(parseFloat,K)??$,S$=U$(),q$=($="")=>(K)=>K??$,b$=q$(),O$=($)=>(K)=>K!=null&&$.includes(K.toLowerCase())?K:_$($),M$=($)=>(K)=>{if(K==null)return $;let Z;try{Z=JSON.parse(K)}catch(Y){B(Y,"Failed to parse JSON",I)}return Z??$},k$=M$({});var M=($,K)=>(Z,Y)=>{let{read:Q,update:X}=K,H=Q(Y);if(q($)){let A=q(H)?c(Z,$,H):H;if(A!=null)Z.set($,A,!1)}y(()=>{let A=Q(Y),j=q($)?Z.get($):C($)?$.get():J($)?$(A):void 0;if(!Object.is(j,A))if((j===null||j===U)&&K.delete)K.delete(Y);else if(j==null||j===G){if(H)X(Y,H)}else X(Y,j)})},E$=($,K)=>M(K,{read:()=>null,update:(Z,Y)=>X$(Z,$,Y)}),h$=($)=>M($,{read:(K)=>K!=null,update:(K,Z)=>Z?B$(K):Promise.resolve(null)}),p$=($)=>M($,{read:(K)=>K.textContent,update:(K,Z)=>H$(K,Z)}),g$=($,K=$)=>M(K,{read:(Z)=>($ in Z)?Z[$]:U,update:(Z,Y)=>{Z[$]=Y}}),d$=($,K=$)=>M(K,{read:(Z)=>Z.getAttribute($),update:(Z,Y)=>J$(Z,$,Y),delete:(Z)=>j$(Z,$)}),c$=($,K=$)=>M(K,{read:(Z)=>Z.hasAttribute($),update:(Z,Y)=>z$(Z,$,Y)}),m$=($,K=$)=>M(K,{read:(Z)=>Z.classList.contains($),update:(Z,Y)=>w$(Z,$,Y)}),o$=($,K=$)=>M(K,{read:(Z)=>Z.style.getPropertyValue($),update:(Z,Y)=>A$(Z,$,Y),delete:(Z)=>V$(Z,$)}),i$=($,K=$,Z=d)=>(Y,Q)=>{y(()=>{let X=q(K)?Y.get(K):C(K)?K.get():J(K)?K():void 0;B(X,`${$} of ${F(Y)+(Q instanceof L&&Y===Q?"":`for ${F(Q)}`)}`,Z)})};export{n as useContext,M as updateElement,m$ as toggleClass,c$ as toggleAttribute,R as toSignal,E as state,p$ as setText,o$ as setStyle,g$ as setProperty,d$ as setAttribute,h$ as removeElement,c as parse,i$ as logMessage,B as log,N as isState,C as isSignal,P as isComputed,w as enqueue,y as effect,E$ as createElement,T as computed,K$ as batch,q$ as asStringWithDefault,b$ as asString,U$ as asNumberWithDefault,S$ as asNumber,M$ as asJSONWithDefault,k$ as asJSON,T$ as asIntegerWithDefault,f$ as asInteger,O$ as asEnum,y$ as asBoolean,Y$ as animationFrame,U as UNSET,L as UIElement,_ as UI,G as RESET,x as LOG_WARN,L$ as LOG_INFO,I as LOG_ERROR,d as LOG_DEBUG};
