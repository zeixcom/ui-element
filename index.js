var C=(B)=>typeof B==="function",JB=(B)=>C(B)&&B.constructor.name==="AsyncFunction",m=(B,Z)=>Object.prototype.toString.call(B)===`[object ${Z}]`,CB=(B)=>B instanceof Error,h=(B)=>B instanceof DOMException&&B.name==="AbortError",WB=(B)=>B instanceof Promise,D=(B)=>CB(B)?B:Error(String(B));class S extends Error{constructor(B){super(`Circular dependency in ${B} detected`);return this}}var L,v=new Set,a=0,t=new Map,c,$B=()=>{c=void 0;let B=Array.from(t.values());t.clear();for(let Z of B)Z()},UB=()=>{if(c)cancelAnimationFrame(c);c=requestAnimationFrame($B)};queueMicrotask($B);var u=(B)=>{if(L&&!B.has(L)){let Z=L;B.add(Z),L.cleanups.add(()=>{B.delete(Z)})}},k=(B)=>{for(let Z of B)if(a)v.add(Z);else Z()},e=()=>{while(v.size){let B=Array.from(v);v.clear();for(let Z of B)Z()}},zB=(B)=>{a++;try{B()}finally{e(),a--}},b=(B,Z)=>{let K=L;L=Z;try{B()}finally{L=K}},O=(B,Z=[])=>new Promise((K,J)=>{t.set(Z,()=>{try{K(B())}catch(W){J(W)}}),UB()});function q(B){let{signals:Z,ok:K,err:J=console.error,nil:W=()=>{}}=C(B)?{signals:[],ok:B}:B,$=!1,X=()=>b(()=>{if($)throw new S("effect");$=!0;let Y=void 0;try{Y=i({signals:Z,ok:K,err:J,nil:W})}catch(Q){J(D(Q))}if(C(Y))X.cleanups.add(Y);$=!1},X);return X.cleanups=new Set,X(),()=>{X.cleanups.forEach((Y)=>Y()),X.cleanups.clear()}}var XB="Computed",qB=(B,Z)=>{if(!Z)return!1;return B.name===Z.name&&B.message===Z.message},_=(B)=>{let Z=new Set,K=C(B)?void 0:{nil:()=>A,err:(...H)=>{if(H.length>1)throw new AggregateError(H);else throw H[0]},...B},J=K?K.ok:B,W=A,$,X=!0,Y=!1,Q=!1,z,j=(H)=>{if(!Object.is(H,W))W=H,X=!1,$=void 0,Y=!0},d=()=>{Y=A!==W,W=A,$=void 0},G=(H)=>{let p=D(H);Y=!qB(p,$),W=A,$=p},M=(H)=>{if(Q=!1,z=void 0,j(H),Y)k(Z)},VB=(H)=>{if(Q=!1,z=void 0,G(H),Y)k(Z)},FB=()=>{Q=!1,z=void 0,ZB()},g=()=>{if(X=!0,z?.abort("Aborted because source signal changed"),Z.size){if(Y)k(Z)}else g.cleanups.forEach((H)=>H()),g.cleanups.clear()};g.cleanups=new Set;let ZB=()=>b(()=>{if(Q)throw new S("computed");if(Y=!1,JB(J)){if(z)return W;if(z=new AbortController,K)K.abort=K.abort instanceof AbortSignal?AbortSignal.any([K.abort,z.signal]):z.signal;z.signal.addEventListener("abort",FB,{once:!0})}let H;Q=!0;try{H=K&&K.signals.length?i(K):J(z?.signal)}catch(p){h(p)?d():G(p),Q=!1;return}if(WB(H))H.then(M,VB);else if(H==null||A===H)d();else j(H);Q=!1},g),r={[Symbol.toStringTag]:XB,get:()=>{if(u(Z),e(),X)ZB();if($)throw $;return W},map:(H)=>_({signals:[r],ok:H}),tap:(H)=>q({signals:[r],...C(H)?{ok:H}:H})};return r},E=(B)=>m(B,XB);var YB="State",o=(B)=>{let Z=new Set,K=B,J={[Symbol.toStringTag]:YB,get:()=>{return u(Z),K},set:(W)=>{if(Object.is(K,W))return;if(K=W,k(Z),A===K)Z.clear()},update:(W)=>{J.set(W(K))},map:(W)=>_({signals:[J],ok:W}),tap:(W)=>q({signals:[J],...C(W)?{ok:W}:W})};return J},y=(B)=>m(B,YB);var A=Symbol(),R=(B)=>y(B)||E(B),QB=(B)=>C(B)&&B.length<2,f=(B)=>R(B)?B:QB(B)?_(B):o(B),i=(B)=>{let{signals:Z,abort:K,ok:J,err:W,nil:$}=B,X=[],Y=!1,Q=Z.map((z)=>{try{let j=z.get();if(j===A)Y=!0;return j}catch(j){if(h(j))throw j;X.push(D(j))}});try{return Y?$(K):X.length?W(...X):J(...Q)}catch(z){if(h(z))throw z;let j=D(z);return W(j)}};var V=(B)=>typeof B==="function",s=(B)=>!!B&&typeof B==="object",x=(B)=>typeof B==="string";var U=!1,jB="debug",MB="info",HB="warn",w="error",xB=(B)=>B?`#${B}`:"",PB=(B)=>B.length?`.${Array.from(B).join(".")}`:"",I=(B)=>`<${B.localName}${xB(B.id)}${PB(B.classList)}>`,N=(B)=>x(B)?`"${B}"`:s(B)?JSON.stringify(B):String(B),n=(B)=>{if(B===null)return"null";if(typeof B!=="object")return typeof B;if(Array.isArray(B))return"Array";if(Symbol.toStringTag in Object(B))return B[Symbol.toStringTag];return B.constructor?.name||"Object"},F=(B,Z,K=jB)=>{if(U||[w,HB].includes(K))console[K](Z,B);return B};var DB=(B)=>B.nodeType===Node.ELEMENT_NODE,LB=(B)=>B instanceof HTMLElement&&B.localName.includes("-"),l=(B,Z,K)=>{let J=B.filter(V).map((W)=>W(Z,K));return()=>{J.filter(V).forEach((W)=>W()),J.length=0}},OB=(B,...Z)=>(K)=>{let J=(K.shadowRoot||K).querySelector(B);if(J)l(Z,K,J)},_B=(B,...Z)=>(K)=>{let J=new Map,W=K.shadowRoot||K,$=(z)=>{if(!J.has(z))J.set(z,l(Z,K,z))},X=(z)=>{let j=J.get(z);if(V(j))j();J.delete(z)},Y=(z)=>(j)=>{if(DB(j)){if(j.matches(B))z(j);j.querySelectorAll(B).forEach(z)}},Q=new MutationObserver((z)=>{for(let j of z)j.addedNodes.forEach(Y($)),j.removedNodes.forEach(Y(X))});return Q.observe(W,{childList:!0,subtree:!0}),W.querySelectorAll(B).forEach($),()=>{Q.disconnect(),J.forEach((z)=>z()),J.clear()}},yB=(B,Z)=>(K,J=K)=>{if(!V(Z))throw new TypeError(`Invalid event listener provided for "${B} event on element ${I(J)}`);return J.addEventListener(B,Z),()=>J.removeEventListener(B,Z)},RB=(B,Z)=>(K,J=K)=>{J.dispatchEvent(new CustomEvent(B,{detail:V(Z)?Z(J):Z,bubbles:!0}))},wB=(B)=>(Z,K)=>{let J=K.localName;if(!LB(K))throw new TypeError("Target element must be a custom element");let W=V(B)?B(K):B;if(!s(W))throw new TypeError("Passed signals must be an object or a provider function");customElements.whenDefined(J).then(()=>{for(let[$,X]of Object.entries(W)){let Y=x(X)?Z.getSignal($):f(X);K.setSignal($,Y)}}).catch(($)=>{throw new Error(`Failed to pass signals to ${I(K)}}`,{cause:$})})};var T=Symbol(),NB=new Set(Object.getOwnPropertyNames(HTMLElement.prototype)),TB=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString"]),BB=(B)=>V(B)&&B.length>=2,SB=(B)=>!(NB.has(B)||TB.has(B)),kB=(B,Z={},K)=>{class J extends HTMLElement{debug;#B={};#K;static observedAttributes=Object.entries(Z)?.filter(([,W])=>BB(W)).map(([W])=>W)??[];constructor(){super();for(let[W,$]of Object.entries(Z)){if($==null)continue;let X=BB($)?$(this,null):V($)?$(this):$;if(X!=null)this.setSignal(W,f(X))}}connectedCallback(){if(U){if(this.debug=this.hasAttribute("debug"),this.debug)F(this,"Connected")}let W=K(this);if(!Array.isArray(W))throw new TypeError(`Expected array of functions as return value of setup function in ${I(this)}`);this.#K=l(W,this,this)}disconnectedCallback(){if(V(this.#K))this.#K();if(U&&this.debug)F(this,"Disconnected")}attributeChangedCallback(W,$,X){if(X===$||E(this.#B[W]))return;let Y=Z[W];if(!BB(Y))return;let Q=Y(this,X,$);if(U&&this.debug)F(X,`Attribute "${W}" of ${I(this)} changed from ${N($)} to ${N(X)}, parsed as <${n(Q)}> ${N(Q)}`);this[W]=Q}getSignal(W){let $=this.#B[W];if(U&&this.debug)F($,`Get ${n($)} "${String(W)}" in ${I(this)}`);return $}setSignal(W,$){if(!SB(String(W)))throw new TypeError(`Invalid property name "${String(W)}". Property names must be valid JavaScript identifiers and not conflict with inherited HTMLElement properties.`);if(!R($))throw new TypeError(`Expected signal as value for property "${String(W)}" on ${I(this)}.`);let X=this.#B[W],Y=y($);if(this.#B[W]=$,Object.defineProperty(this,W,{get:$.get,set:Y?$.set:void 0,enumerable:!0,configurable:Y}),X&&y(X))X.set(A);if(U&&this.debug)F($,`Set ${n($)} "${String(W)} in ${I(this)}`)}}return customElements.define(B,J),J};var KB="context-request";class IB extends Event{B;Z;K;constructor(B,Z,K=!1){super(KB,{bubbles:!0,composed:!0});this.context=B;this.callback=Z;this.subscribe=K}}var bB=(B)=>(Z)=>{let K=(J)=>{let{context:W,callback:$}=J;if(B.includes(W)&&V($))J.stopPropagation(),$(Z.getSignal(String(W)))};return Z.addEventListener(KB,K),()=>Z.removeEventListener(KB,K)},EB=(B)=>(Z)=>{let K;return Z.dispatchEvent(new IB(B,(J)=>{K=J})),K};var AB=(B,Z)=>{if(Z==null)return;let K=B(Z);return Number.isFinite(K)?K:void 0},fB=(B,Z)=>Z!=="false"&&Z!=null,dB=(B=0)=>(Z,K)=>AB(parseInt,K)??B,pB=(B=0)=>(Z,K)=>AB(parseFloat,K)??B,hB=(B="")=>(Z,K)=>K??B,gB=(B)=>(Z,K)=>K!=null&&B.includes(K.toLowerCase())?K:B[0],mB=(B)=>(Z,K)=>{if((K??B)==null)throw new ReferenceError("Value and fallback are both null or undefined");if(K==null)return B;if(K==="")throw new SyntaxError("Empty string is not valid JSON");let J;try{J=JSON.parse(K)}catch(W){throw new SyntaxError(`Failed to parse JSON: ${String(W)}`,{cause:W})}return J??B};var GB=(B,Z,K)=>x(B)?Z.getSignal(B).get():R(B)?B.get():V(B)?B(K):T,vB=(B)=>{if(/^(mailto|tel):/i.test(B))return!0;if(B.includes("://"))try{let Z=new URL(B,window.location.origin);return["http:","https:","ftp:"].includes(Z.protocol)}catch(Z){return!1}return!0},cB=(B,Z,K)=>{if(/^on/i.test(Z))throw new Error(`Unsafe attribute: ${Z}`);if(K=String(K).trim(),!vB(K))throw new Error(`Unsafe URL for ${Z}: ${K}`);B.setAttribute(Z,K)},P=(B,Z)=>(K,J)=>{let{op:W,read:$,update:X}=Z,Y=$(J),Q={a:"attribute ",c:"class ",h:"inner HTML",p:"property ",s:"style property ",t:"text content"},z="";if(x(B)&&x(Y)&&K[B]===T)K.attributeChangedCallback(B,null,Y);let j=(G)=>()=>{if(U&&K.debug)F(J,`${G} ${Q[W]+z} of ${I(J)} in ${I(K)}`);Z.resolve?.(J)},d=(G)=>(M)=>{F(M,`Failed to ${G} ${Q[W]+z} of ${I(J)} in ${I(K)}`,w),Z.reject?.(M)};return q(()=>{let G=T;try{G=GB(B,K,J)}catch(M){F(M,`Failed to resolve value of ${N(B)} for ${Q[W]+z} of ${I(J)} in ${I(K)}`,w);return}if(G===T)G=Y;else if(G===A)G=Z.delete?null:Y;if(Z.delete&&G===null)O(()=>{return z=Z.delete(J),!0},[J,W]).then(j("Deleted")).catch(d("delete"));else if(G!=null){let M=$(J);if(Object.is(G,M))return;O(()=>{return z=X(J,G),!0},[J,W]).then(j("Updated")).catch(d("update"))}})},uB=(B,Z)=>(K,J)=>{let{position:W="beforeend",create:$}=Z,X=(Q)=>()=>{if(U&&K.debug)F(J,`${Q} element in ${I(J)} in ${I(K)}`);Z.resolve?.(J)},Y=(Q)=>(z)=>{F(z,`Failed to ${Q} element in ${I(J)} in ${I(K)}`,w),Z.reject?.(z)};return q(()=>{let Q=0;try{Q=GB(B,K,J)}catch(z){F(z,`Failed to resolve value of ${N(B)} for insertion or deletion in ${I(J)} in ${I(K)}`,w);return}if(Q===T)Q=0;if(Q>0)O(()=>{for(let z=0;z<Q;z++){let j=$(J);if(!j)continue;J.insertAdjacentElement(W,j)}return!0},[J,"i"]).then(X("Inserted")).catch(Y("insert"));else if(Q<0){let z={beforebegin:"previousElementSibling",afterbegin:"firstElementChild",beforeend:"lastElementChild",afterend:"nextElementSibling"};O(()=>{for(let j=0;j>Q;j--)J[z[W]]?.remove();return!0},[J,"r"]).then(X("Removed")).catch(Y("remove"))}})},iB=(B)=>P(B,{op:"t",read:(Z)=>Z.textContent,update:(Z,K)=>{return Array.from(Z.childNodes).filter((J)=>J.nodeType!==Node.COMMENT_NODE).forEach((J)=>J.remove()),Z.append(document.createTextNode(K)),""}}),oB=(B,Z=B)=>P(Z,{op:"p",read:(K)=>(B in K)?K[B]:A,update:(K,J)=>{return K[B]=J,String(B)}}),sB=(B,Z=B)=>P(Z,{op:"a",read:(K)=>K.getAttribute(B),update:(K,J)=>{return cB(K,B,J),B},delete:(K)=>{return K.removeAttribute(B),B}}),nB=(B,Z=B)=>P(Z,{op:"a",read:(K)=>K.hasAttribute(B),update:(K,J)=>{return K.toggleAttribute(B,J),B}}),lB=(B,Z=B)=>P(Z,{op:"c",read:(K)=>K.classList.contains(B),update:(K,J)=>{return K.classList.toggle(B,J),B}}),rB=(B,Z=B)=>P(Z,{op:"s",read:(K)=>K.style.getPropertyValue(B),update:(K,J)=>{return K.style.setProperty(B,J),B},delete:(K)=>{return K.style.removeProperty(B),B}}),aB=(B,Z,K)=>P(B,{op:"h",read:(J)=>(J.shadowRoot||!Z?J:null)?.innerHTML??"",update:(J,W)=>{if(!W){if(J.shadowRoot)J.shadowRoot.innerHTML="<slot></slot>";return""}if(Z&&!J.shadowRoot)J.attachShadow({mode:Z});let $=J.shadowRoot||J;if($.innerHTML=W,!K)return"";return $.querySelectorAll("script").forEach((X)=>{let Y=document.createElement("script");Y.appendChild(document.createTextNode(X.textContent??"")),$.appendChild(Y),X.remove()})," with scripts"}});export{b as watch,P as updateElement,lB as toggleClass,nB as toggleAttribute,f as toSignal,o as state,iB as setText,rB as setStyle,oB as setProperty,sB as setAttribute,bB as provide,wB as pass,yB as on,F as log,y as isState,R as isSignal,E as isComputed,uB as insertOrRemoveElement,OB as first,O as enqueue,RB as emit,q as effect,aB as dangerouslySetInnerHTML,EB as consume,_ as computed,kB as component,zB as batch,hB as asString,pB as asNumber,mB as asJSON,dB as asInteger,gB as asEnum,fB as asBoolean,_B as all,A as UNSET,T as RESET,HB as LOG_WARN,MB as LOG_INFO,w as LOG_ERROR,jB as LOG_DEBUG};
