var M=($)=>typeof $==="function",J$=($)=>M($)&&$.constructor.name==="AsyncFunction",g=($,K)=>Object.prototype.toString.call($)===`[object ${K}]`,q$=($)=>$ instanceof Error,p=($)=>$ instanceof DOMException&&$.name==="AbortError",z$=($)=>$ instanceof Promise,O=($)=>q$($)?$:Error(String($));class N extends Error{constructor($){super(`Circular dependency in ${$} detected`);return this}}var _,h=new Set,a=0,e=new Map,v,X$=()=>{v=void 0;let $=Array.from(e.values());e.clear();for(let K of $)K()},L$=()=>{if(v)cancelAnimationFrame(v);v=requestAnimationFrame(X$)};queueMicrotask(X$);var c=($)=>{if(_&&!$.has(_)){let K=_;$.add(K),_.cleanups.add(()=>{$.delete(K)})}},w=($)=>{for(let K of $)if(a)h.add(K);else K()},$$=()=>{while(h.size){let $=Array.from(h);h.clear();for(let K of $)K()}},Y$=($)=>{a++;try{$()}finally{$$(),a--}},S=($,K)=>{let B=_;_=K;try{$()}finally{_=B}},y=($,K=[])=>new Promise((B,Z)=>{e.set(K,()=>{try{B($())}catch(W){Z(W)}}),L$()});function U($){let{signals:K,ok:B,err:Z=console.error,nil:W=()=>{}}=M($)?{signals:[],ok:$}:$,H=!1,I=()=>S(()=>{if(H)throw new N("effect");H=!0;let J=void 0;try{J=u({signals:K,ok:B,err:Z,nil:W})}catch(Y){Z(O(Y))}if(M(J))I.cleanups.add(J);H=!1},I);return I.cleanups=new Set,I(),()=>{I.cleanups.forEach((J)=>J()),I.cleanups.clear()}}var Q$="Computed",x$=($,K)=>{if(!K)return!1;return $.name===K.name&&$.message===K.message},R=($)=>{let K=new Set,B=M($)?void 0:{nil:()=>A,err:(...X)=>{if(X.length>1)throw new AggregateError(X);else throw X[0]},...$},Z=B?B.ok:$,W=A,H,I=!0,J=!1,Y=!1,Q,z=(X)=>{if(!Object.is(X,W))W=X,I=!1,H=void 0,J=!0},F=()=>{J=A!==W,W=A,H=void 0},P=(X)=>{let f=O(X);J=!x$(f,H),W=A,H=f},r=(X)=>{if(Y=!1,Q=void 0,z(X),J)w(K)},P$=(X)=>{if(Y=!1,Q=void 0,P(X),J)w(K)},U$=()=>{Y=!1,Q=void 0,I$()},m=()=>{if(I=!0,Q?.abort("Aborted because source signal changed"),K.size){if(J)w(K)}else m.cleanups.forEach((X)=>X()),m.cleanups.clear()};m.cleanups=new Set;let I$=()=>S(()=>{if(Y)throw new N("computed");if(J=!1,J$(Z)){if(Q)return W;if(Q=new AbortController,B)B.abort=B.abort instanceof AbortSignal?AbortSignal.any([B.abort,Q.signal]):Q.signal;Q.signal.addEventListener("abort",U$,{once:!0})}let X;Y=!0;try{X=B&&B.signals.length?u(B):Z(Q?.signal)}catch(f){p(f)?F():P(f),Y=!1;return}if(z$(X))X.then(r,P$);else if(X==null||A===X)F();else z(X);Y=!1},m),t={[Symbol.toStringTag]:Q$,get:()=>{if(c(K),$$(),I)I$();if(H)throw H;return W},map:(X)=>R({signals:[t],ok:X}),tap:(X)=>U({signals:[t],...M(X)?{ok:X}:X})};return t},b=($)=>g($,Q$);var j$="State",i=($)=>{let K=new Set,B=$,Z={[Symbol.toStringTag]:j$,get:()=>{return c(K),B},set:(W)=>{if(Object.is(B,W))return;if(B=W,w(K),A===B)K.clear()},update:(W)=>{Z.set(W(B))},map:(W)=>R({signals:[Z],ok:W}),tap:(W)=>U({signals:[Z],...M(W)?{ok:W}:W})};return Z},q=($)=>g($,j$);var A=Symbol(),x=($)=>q($)||b($),A$=($)=>M($)&&$.length<2,k=($)=>x($)?$:A$($)?R($):i($),u=($)=>{let{signals:K,abort:B,ok:Z,err:W,nil:H}=$,I=[],J=!1,Y=K.map((Q)=>{try{let z=Q.get();if(z===A)J=!0;return z}catch(z){if(p(z))throw z;I.push(O(z))}});try{return J?H(B):I.length?W(...I):Z(...Y)}catch(Q){if(p(Q))throw Q;let z=O(Q);return W(z)}};var G=($)=>typeof $==="function",d=($)=>!!$&&typeof $==="object",L=($)=>typeof $==="string";var V=!1,G$="debug",D$="info",C$="warn",E="error",O$=($)=>$?`#${$}`:"",_$=($)=>$.length?`.${Array.from($).join(".")}`:"",j=($)=>`<${$.localName}${O$($.id)}${_$($.classList)}>`,o=($)=>L($)?`"${$}"`:d($)?JSON.stringify($):String($),n=($)=>{if($===null)return"null";if(typeof $!=="object")return typeof $;if(Array.isArray($))return"Array";if(Symbol.toStringTag in Object($))return $[Symbol.toStringTag];return $.constructor?.name||"Object"},C=($,K,B=G$)=>{if(V||[E,C$].includes(B))console[B](K,$);return $};var B$=($)=>G($)&&$.length==2,y$=($)=>G($)||d($)&&G($.handleEvent),R$=($)=>$ instanceof HTMLElement&&$.localName.includes("-"),s=($,K,B,Z)=>$.flatMap((W)=>{let H=G(W)?W(K,B??K,Z):[];return Array.isArray(H)?H.filter(G):G(H)?[H]:[]}),T$=($,...K)=>(B)=>{let Z=(B.shadowRoot||B).querySelector($);return Z?s(K,B,Z):[]},N$=($,...K)=>(B)=>Array.from((B.shadowRoot||B).querySelectorAll($)).flatMap((Z,W)=>s(K,B,Z,W)),w$=($,K)=>(B,Z=B,W=0)=>{let H=B$(K)?K(Z,W):K;if(!y$(H))throw new TypeError(`Invalid event listener provided for "${$} event on element ${j(Z)}`);return Z.addEventListener($,H),()=>Z.removeEventListener($,H)},S$=($,K)=>(B,Z=B,W=0)=>{Z.dispatchEvent(new CustomEvent($,{detail:B$(K)?K(Z,W):K,bubbles:!0}))},b$=($)=>(K,B,Z=0)=>{let W=B.localName;if(!R$(B))throw new TypeError("Target element must be a custom element");let H=B$($)?$(B,Z):$;if(!d(H))throw new TypeError("Passed signals must be an object or a provider function");customElements.whenDefined(W).then(()=>{for(let[I,J]of Object.entries(H)){let Y=L(J)?K.getSignal(I):k(J);B.setSignal(I,Y)}}).catch((I)=>{throw new Error(`Failed to pass signals to ${j(B)}}`,{cause:I})})};var T=Symbol(),k$=new Set(Object.getOwnPropertyNames(HTMLElement.prototype)),E$=new Set(["constructor","prototype","__proto__","toString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString"]),K$=($)=>G($)&&$.length>=2,f$=($)=>G($)&&$.length<2,p$=($)=>!(k$.has($)||E$.has($)),d$=($,K={},B)=>{class Z extends HTMLElement{debug;#$={};#B=[];static observedAttributes=Object.entries(K)?.filter(([,W])=>K$(W)).map(([W])=>W)??[];constructor(){super();for(let[W,H]of Object.entries(K)){if(H==null)continue;let I=K$(H)?H(this,null):f$(H)?H(this):H;this.setSignal(W,k(I??T))}}connectedCallback(){if(V){if(this.debug=this.hasAttribute("debug"),this.debug)C(this,"Connected")}let W=B(this);if(!Array.isArray(W))throw new TypeError(`Expected array of functions as return value of setup() in ${j(this)}`);this.#B=s(W,this)}disconnectedCallback(){for(let W of this.#B)W();if(this.#B.length=0,V&&this.debug)C(this,"Disconnected")}attributeChangedCallback(W,H,I){if(I===H||b(this.#$[W]))return;let J=K[W];if(!K$(J))return;let Y=J(this,I,H);if(V&&this.debug)C(I,`Attribute "${W}" of ${j(this)} changed from ${o(H)} to ${o(I)}, parsed as <${n(Y)}> ${o(Y)}`);this[W]=Y}getSignal(W){let H=this.#$[W];if(V&&this.debug)C(H,`Get ${n(H)} "${String(W)}" in ${j(this)}`);return H}setSignal(W,H){if(!p$(String(W)))throw new TypeError(`Invalid property name "${String(W)}". Property names must be valid JavaScript identifiers and not conflict with inherited HTMLElement properties.`);if(!x(H))throw new TypeError(`Expected signal as value for property "${String(W)}" on ${j(this)}.`);let I=this.#$[W],J=q(H);if(this.#$[W]=H,Object.defineProperty(this,W,{get:H.get,set:J?H.set:void 0,enumerable:!0,configurable:J}),I&&q(I))I.set(A);if(V&&this.debug)C(H,`Set ${n(H)} "${String(W)} in ${j(this)}`)}}return customElements.define($,Z),Z};var Z$="context-request";class F$ extends Event{$;K;B;constructor($,K,B=!1){super(Z$,{bubbles:!0,composed:!0});this.context=$;this.callback=K;this.subscribe=B}}var m$=($)=>(K)=>{let B=(Z)=>{let{context:W,callback:H}=Z;if($.includes(W)&&G(H))Z.stopPropagation(),H(K.getSignal(String(W)))};return K.addEventListener(Z$,B),()=>K.removeEventListener(Z$,B)},g$=($)=>(K)=>{let B;return K.dispatchEvent(new F$($,(Z)=>{B=Z})),B};var V$=($,K)=>{if(K==null)return;let B=$(K);return Number.isFinite(B)?B:void 0},h$=($,K)=>K!=="false"&&K!=null,v$=($=0)=>(K,B)=>V$(parseInt,B)??$,c$=($=0)=>(K,B)=>V$(parseFloat,B)??$,u$=($="")=>(K,B)=>B??$,i$=($)=>(K,B)=>B!=null&&$.includes(B.toLowerCase())?B:$[0],o$=($)=>(K,B)=>{if((B??$)==null)throw new ReferenceError("Value and fallback are both null or undefined");if(B==null)return $;if(B==="")throw new SyntaxError("Empty string is not valid JSON");let Z;try{Z=JSON.parse(B)}catch(W){throw new SyntaxError(`Failed to parse JSON: ${String(W)}`,{cause:W})}return Z??$};var l={a:"attribute ",c:"class ",h:"inner HTML",p:"property ",s:"style property ",t:"text content"},W$=($,K,B,Z)=>L($)?K.getSignal($).get():x($)?$.get():G($)?$(B,Z):T,n$=($)=>{if(/^(mailto|tel):/i.test($))return!0;if($.includes("://"))try{let K=new URL($,window.location.origin);return["http:","https:","ftp:"].includes(K.protocol)}catch(K){return!1}return!0},M$=($,K,B)=>{if(/^on/i.test(K))throw new Error(`Unsafe attribute: ${K}`);if(B=String(B).trim(),!n$(B))throw new Error(`Unsafe URL for ${K}: ${B}`);$.setAttribute(K,B)},D=($,K)=>(B,Z,W=0)=>{let{op:H,read:I,update:J}=K,Y=I(Z);if(L($)&&L(Y)&&B[$]===T)B.attributeChangedCallback($,null,Y);let Q=(z,F,P="element")=>C(z,`Failed to ${F} ${P} ${j(Z)} in ${j(B)}`,E);return U(()=>{let z=T;try{z=W$($,B,Z,W)}catch(F){Q(F,"update");return}if(z===T)z=Y;if(z===A)z=K.delete?null:Y;if(K.delete&&z===null){let F="";y(()=>{return F=K.delete(Z),!0},[Z,H]).then(()=>{if(V&&B.debug)C(Z,`Deleted ${l[H]+F} of ${j(Z)} in ${j(B)}`)}).catch((P)=>{Q(P,"delete",`${l[H]+F} of`)})}else if(z!=null){let F=I(Z);if(Object.is(z,F))return;let P="";y(()=>{return P=J(Z,z),!0},[Z,H]).then(()=>{if(V&&B.debug)C(Z,`Updated ${l[H]+P} of ${j(Z)} in ${j(B)}`)}).catch((r)=>{Q(r,"update",`${l[H]+P} of`)})}})},H$=($,{type:K,where:B,create:Z})=>(W,H,I=0)=>{let J={beforebegin:"before",afterbegin:"prepend",beforeend:"append",afterend:"after"};if(!G(H[J[B]]))throw new TypeError(`Invalid insertPosition "${B}" for ${j(W)}`);let Y=(Q)=>C(Q,`Failed to insert ${K} into ${j(W)}:`,E);return U(()=>{let Q=!1;try{Q=W$($,W,H,I)}catch(z){Y(z);return}if(!Q)return;y(()=>{let z=Z();if(!z)return;H[J[B]](z)},[H,"i"]).then(()=>{let z=x($)?$:L($)?W.getSignal($):void 0;if(q(z))z.set(!1);if(V&&W.debug)C(H,`Inserted ${K} into ${j(W)}`)}).catch((z)=>{Y(z)})})},s$=($)=>D($,{op:"t",read:(K)=>K.textContent,update:(K,B)=>{return Array.from(K.childNodes).filter((Z)=>Z.nodeType!==Node.COMMENT_NODE).forEach((Z)=>Z.remove()),K.append(document.createTextNode(B)),""}}),l$=($,K=$)=>D(K,{op:"p",read:(B)=>($ in B)?B[$]:A,update:(B,Z)=>{return B[$]=Z,String($)}}),r$=($,K=$)=>D(K,{op:"a",read:(B)=>B.getAttribute($),update:(B,Z)=>{return M$(B,$,Z),$},delete:(B)=>{return B.removeAttribute($),$}}),t$=($,K=$)=>D(K,{op:"a",read:(B)=>B.hasAttribute($),update:(B,Z)=>{return B.toggleAttribute($,Z),$}}),a$=($,K=$)=>D(K,{op:"c",read:(B)=>B.classList.contains($),update:(B,Z)=>{return B.classList.toggle($,Z),$}}),e$=($,K=$)=>D(K,{op:"s",read:(B)=>B.style.getPropertyValue($),update:(B,Z)=>{return B.style.setProperty($,Z),$},delete:(B)=>{return B.style.removeProperty($),$}}),$B=($,K,B)=>D($,{op:"h",read:(Z)=>(Z.shadowRoot||!K?Z:null)?.innerHTML??"",update:(Z,W)=>{if(!W){if(Z.shadowRoot)Z.shadowRoot.innerHTML="<slot></slot>";return""}if(K&&!Z.shadowRoot)Z.attachShadow({mode:K});let H=Z.shadowRoot||Z;if(H.innerHTML=W,!B)return"";return H.querySelectorAll("script").forEach((I)=>{let J=document.createElement("script");J.appendChild(document.createTextNode(I.textContent??"")),H.appendChild(J),I.remove()})," with scripts"}}),BB=($,K,B="beforeend",Z)=>{if(!($ instanceof HTMLTemplateElement))throw new TypeError("Expected template to be an HTMLTemplateElement");return H$(K,{type:"template content",where:B,create:()=>{let W=document.importNode($.content,!0),H=W.querySelector("slot");if(H)H.replaceWith(document.createTextNode(Z?Z:H.textContent??""));return W}})},KB=($,K,B="beforeend",Z={},W)=>H$(K,{type:"new element",where:B,create:()=>{let H=document.createElement($);for(let[I,J]of Object.entries(Z))M$(H,I,J);if(W)H.textContent=W;return H}}),ZB=($)=>(K,B,Z=0)=>{let W=(H)=>C(H,`Failed to delete ${j(B)} from ${j(K)}:`,E);return U(()=>{let H=!1;try{H=W$($,K,B,Z)}catch(I){W(I);return}if(!H)return;y(()=>{return B.remove(),!0},[B,"r"]).then(()=>{let I=x($)?$:L($)?K.getSignal($):void 0;if(q(I))I.set(!1);if(V&&K.debug)C(B,`Deleted ${j(B)} into ${j(K)}`)}).catch((I)=>{W(I)})})};export{S as watch,D as updateElement,a$ as toggleClass,t$ as toggleAttribute,k as toSignal,i as state,s$ as setText,e$ as setStyle,l$ as setProperty,r$ as setAttribute,ZB as removeElement,m$ as provide,b$ as pass,w$ as on,C as log,q as isState,x as isSignal,b as isComputed,BB as insertTemplate,H$ as insertNode,T$ as first,y as enqueue,S$ as emit,U as effect,$B as dangerouslySetInnerHTML,KB as createElement,g$ as consume,R as computed,d$ as component,Y$ as batch,u$ as asString,c$ as asNumber,o$ as asJSON,v$ as asInteger,i$ as asEnum,h$ as asBoolean,N$ as all,A as UNSET,T as RESET,C$ as LOG_WARN,D$ as LOG_INFO,E as LOG_ERROR,G$ as LOG_DEBUG};
