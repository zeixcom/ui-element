
<tab-list>
	<menu>
		<li><button type="button" aria-pressed="true">HTML</button></li>
		<li><button type="button" aria-pressed="false">CSS</button></li>
		<li><button type="button" aria-pressed="false">TypeScript</button></li>
	</menu>
	
	<accordion-panel open>
		<details open aria-disabled="true">
			<summary class="visually-hidden">
				<div class="summary">HTML</div>
			</summary>
			<code-block language="html" copy-success="Copied!" copy-error="Error trying to copy to clipboard!">
				<p class="meta">
					<span class="file">input-field.html</span>
					<span class="language">html</span>
				</p>
				<pre class="language-html"><code>&lt;input-field&gt;
	&lt;label for=&quot;name-input&quot;&gt;Name&lt;/label&gt;
	&lt;div class=&quot;row&quot;&gt;
		&lt;div class=&quot;group auto&quot;&gt;
			&lt;input type=&quot;text&quot; id=&quot;name-input&quot; name=&quot;name&quot; autocomplete=&quot;name&quot; required&gt;
		&lt;/div&gt;
	&lt;/div&gt;
	&lt;p class=&quot;error&quot; aria-live=&quot;assertive&quot; id=&quot;name-error&quot;&gt;&lt;/p&gt;
&lt;/input-field&gt;

&lt;input-field integer&gt;
	&lt;label for=&quot;bday-year-input&quot;&gt;Birthday Year&lt;/label&gt;
	&lt;div class=&quot;row&quot;&gt;
		&lt;div class=&quot;group short&quot;&gt;
			&lt;input type=&quot;number&quot; id=&quot;bday-year-input&quot; name=&quot;bday-year&quot; autocomplete=&quot;bday-year&quot; required minlength=&quot;4&quot; maxlength=&quot;4&quot; min=&quot;1900&quot; max=&quot;2024&quot; step=&quot;1&quot;&gt;
		&lt;/div&gt;
		&lt;div class=&quot;spinbutton&quot; data-step=&quot;1&quot;&gt;
			&lt;button type=&quot;button&quot; class=&quot;decrement&quot; aria-label=&quot;Decrement&quot;&gt;âˆ’&lt;/button&gt;
			&lt;button type=&quot;button&quot; class=&quot;increment&quot; aria-label=&quot;Increment&quot;&gt;+&lt;/button&gt;
		&lt;/div&gt;
	&lt;/div&gt;
	&lt;p class=&quot;error&quot; aria-live=&quot;assertive&quot; id=&quot;bday-year-error&quot;&gt;&lt;/p&gt;
	&lt;p class=&quot;description&quot; aria-live=&quot;polite&quot; id=&quot;bday-year-description&quot;&gt;&lt;/p&gt;
&lt;/input-field&gt;

&lt;input-field validate=&quot;./examples/snippets/validate.html&quot;&gt;
	&lt;label for=&quot;username-input&quot;&gt;Username&lt;/label&gt;
	&lt;div class=&quot;row&quot;&gt;
		&lt;div class=&quot;group auto&quot;&gt;
			&lt;input type=&quot;text&quot; id=&quot;username-input&quot; name=&quot;username&quot; autocomplete=&quot;username&quot; aria-describedby=&quot;username-description&quot; required minlength=&quot;4&quot; maxlength=&quot;20&quot;&gt;
		&lt;/div&gt;
	&lt;/div&gt;
	&lt;p class=&quot;error&quot; aria-live=&quot;assertive&quot; id=&quot;username-error&quot;&gt;&lt;/p&gt;
	&lt;p class=&quot;description&quot; aria-live=&quot;polite&quot; id=&quot;username-description&quot; data-remaining=&quot;${x} characters remaining&quot;&gt;Max. 20 characters&lt;/p&gt;
&lt;/input-field&gt;</code></pre>
				<input-button class="copy">
					<button type="button" class="secondary small">Copy</button>
				</input-button>
			</code-block>
		</details>
	</accordion-panel>

	<accordion-panel>
		<details aria-disabled="true">
			<summary class="visually-hidden">
				<div class="summary">CSS</div>
			</summary>
			<code-block language="css" copy-success="Copied!" copy-error="Error trying to copy to clipboard!">
				<p class="meta">
					<span class="file">input-field.css</span>
					<span class="language">css</span>
				</p>
				<pre class="language-css"><code>input-field {
	width: 100%;

	&amp;[value=&quot;0&quot;] input {
		color: color-mix(in srgb, var(--color-text) 50%, transparent);
	}

	&amp;:hover button {
		opacity: var(--opacity-translucent);

		&amp;:not(:disabled) {
			opacity: var(--opacity-solid);
			cursor: pointer;
		}
	}

	&amp;:focus-within {

		&amp; label,
		&amp; p,
		&amp; span {
			opacity: var(--opacity-solid);
		}

		&amp; button {
			opacity: var(--opacity-translucent);

			&amp;:not(:disabled) {
				opacity: var(--opacity-solid);
				cursor: pointer;
			}
		}

		&amp; input {
			color: var(--color-text);
		}
	}

	&amp; label,
	&amp; p,
	&amp; span {
		opacity: var(--opacity-dimmed);
		transition: opacity var(--transition-short) var(--easing-inout);
	}

	&amp; label {
		display: block;
		font-size: var(--font-size-s);
		color: var(--color-text);
		margin-bottom: var(--space-xxs);
	}

	.row {
		display: flex;
		gap: var(--space-s);
	}

	.group {
		display: flex;
		align-items: baseline;
		background: var(--color-input);
		border-bottom: 1px solid var(--color-border);
		width: 100%;

		&amp;.short {
			width: 6rem;
		}

		.clear {
			border: 0;
			border-radius: 50%;
			color: var(--color-input);
			width: var(--space-m);
			height: var(--space-m);
			line-height: 1.1;
			align-self: center;
			text-align: center;
			padding: 0;
			margin: 0 var(--space-xxs);
		}

		.hidden {
			display: none;
		}

		&amp; span:first-child {
			padding-left: var(--space-xs);
		}

		&amp; span:last-child {
			padding-right: var(--space-xs);
		}
	}

	&amp; input {
		flex-grow: 1;
		display: inline-block;
		box-sizing: border-box;
		background: var(--color-input);
		color: var(--color-text);
		border: 0;
		padding: var(--space-xs) var(--space-xxs);
		font-size: var(--font-size-m);
		height: 2rem;
		width: 100%;
		transition: color var(--transition-short) var(--easing-inout);

		&amp;::placeholder {
			color: var(--color-text);
			opacity: var(--opacity-translucent);
		}
	}

	&amp; input[type=&quot;number&quot;] {
		text-align: right;
	}

	&amp; input[aria-invalid=&quot;true&quot;] {
		box-shadow: 0 0 var(--space-xxs) 2px var(--color-error);
	}

	&amp; span {
		flex-grow: 0;
	}

	::-webkit-textfield-decoration-container {
		height: 100%;
	}

	::-webkit-inner-spin-button {
		appearance: none;
	}

	.spinbutton {
		display: flex;
	}

	&amp; button {
		border: 1px solid var(--color-border);
		background-color: var(--color-secondary);
		color: var(--color-text);
		padding: var(--space-xs) var(--space-s);
		font-size: var(--font-size-s);
		line-height: var(--line-height-s);
		width: 2rem;
		height: 2rem;
		opacity: var(--opacity-transparent);
		transition: opacity var(--transition-short) var(--easing-inout);
		user-select: none;

		&amp;:disabled {
			cursor: revert;
			background-color: var(--color-background);
		}

		&amp;:not(:disabled) {

			&amp;:hover {
				background-color: var(--color-secondary-hover);
			}

			&amp;:active {
				background-color: var(--color-secondary-active);
			}
		}
	}

	.decrement {
		border-radius: var(--space-xs) 0 0 var(--space-xs); 
	}

	.increment {
		border-radius: 0 var(--space-xs) var(--space-xs) 0;
		border-left: 0;
	}

	.error,
	.description {
		margin: var(--space-xs) 0 0;
		font-size: var(--font-size-xs);
		line-height: var(--line-height-s);

		&amp;:empty {
			display: none;
		}
	}

	.error {
		color: color-mix(in srgb, var(--color-text) 50%, var(--color-error));
	}

	.description {
		color: var(--color-text-soft);
	}
}
</code></pre>
				<input-button class="copy">
					<button type="button" class="secondary small">Copy</button>
				</input-button>
			</code-block>
		</details>
	</accordion-panel>

	<accordion-panel>
		<details aria-disabled="true">
			<summary class="visually-hidden">
				<div class="summary">TS</div>
			</summary>
			<code-block language="ts" copy-success="Copied!" copy-error="Error trying to copy to clipboard!">
				<p class="meta">
					<span class="file">input-field.ts</span>
					<span class="language">ts</span>
				</p>
				<pre class="language-ts"><code>import { effect, setAttribute, setProperty, setText, toggleClass, UIElement } from &quot;@zeix/ui-element&quot;

/* === Pure functions === */

// Check if value is a number
const isNumber = (num: any) =&gt; typeof num === &#39;number&#39;

// Parse a value as a number with optional integer flag and fallback value
const parseNumber = (v: any, int = false, fallback = 0): number =&gt; {
	const temp = int ? parseInt(v, 10) : parseFloat(v)
	return Number.isFinite(temp) ? temp : fallback
}

// Round a value to the nearest step
const nearestStep = (
	v: number,
	min: number,
    max: number,
    step: number,
	int: boolean = false
) =&gt; {
	const steps = Math.round((max - min) / step)
	// Bring to 0-1 range
	let zerone = Math.round((v - min) * steps / (max - min)) / steps
	// Keep in range in case value is off limits
	zerone = Math.min(Math.max(zerone, 0), 1)
	const value = zerone * (max - min) + min
	return int ? Math.round(value) : value
}

/* === Class definition === */

export class InputField extends UIElement {
	static observedAttributes = [&#39;value&#39;, &#39;description&#39;]
	static states = {
		value: (v: string, el: InputField) =&gt;
			el.isNumber ? parseNumber(v, el.isInteger, 0) : v
	}
	isNumber?: boolean
	isInteger?: boolean
	input: HTMLInputElement | null = null
	step: number = 1
	min: number | undefined
	max: number | undefined

	connectedCallback() {

		// Set properties
		this.input = this.querySelector(&#39;input&#39;)
		this.isNumber = (this.input &amp;&amp; this.input.type === &#39;number&#39;) ?? false
		this.isInteger = this.hasAttribute(&#39;integer&#39;)
		if (this.input &amp;&amp; this.isNumber) {
			this.step = parseNumber(this.input.step, this.isInteger, 1)
			this.min = parseNumber(this.input.min, this.isInteger, 0)
			this.max = parseNumber(this.input.max, this.isInteger, 0)
		}

		// Set default states
		this.set(&#39;value&#39;, this.isNumber ? this.input?.valueAsNumber : this.input?.value, false)
		this.set(&#39;length&#39;, this.input?.value.length)
		
		// Derived states
		this.set(&#39;empty&#39;, () =&gt; !this.get(&#39;length&#39;))

		// Handle input changes
		this.first(&#39;input&#39;)
			.on(&#39;change&#39;, () =&gt; {
				this.#triggerChange(this.isNumber ? this.input?.valueAsNumber : this.input?.value)
			})
			.on(&#39;input&#39;, () =&gt; {
				this.set(&#39;length&#39;, this.input?.value.length)
			})

		// Handle arrow key events to increment / decrement value
		if (this.isNumber) {
			this.first(&#39;input&#39;).on(&#39;keydown&#39;, (e: Event) =&gt; {
				const evt = e as KeyboardEvent
				if ([&#39;ArrowUp&#39;, &#39;ArrowDown&#39;].includes(evt.key)) {
					e.stopPropagation()
					e.preventDefault()
					if (evt.key === &#39;ArrowDown&#39;)
						this.stepDown(evt.shiftKey ? this.step * 10 : this.step)
					if (evt.key === &#39;ArrowUp&#39;)
						this.stepUp(evt.shiftKey ? this.step * 10 : this.step)
				}
			})
		}

		// Setup error message
		this.set(&#39;ariaInvalid&#39;, () =&gt; String(Boolean(this.get(&#39;error&#39;))))
		this.set(&#39;aria-errormessage&#39;, () =&gt; this.get(&#39;error&#39;) ? this.querySelector(&#39;.error&#39;)?.id : undefined)
		this.first(&#39;.error&#39;).sync(setText(&#39;error&#39;))
		this.first(&#39;input&#39;).sync(
			setProperty(&#39;ariaInvalid&#39;),
			setAttribute(&#39;aria-errormessage&#39;)
		)

		// Setup description
		const description = this.querySelector(&#39;.description&#39;) as HTMLElement | null
		if (description) {
			
			// Derived states
			const maxLength = this.input?.maxLength
			const remainingMessage = maxLength &amp;&amp; description.dataset.remaining
			const defaultDescription = description.textContent
			this.set(&#39;description&#39;, remainingMessage
				? () =&gt; {
					const length = this.get&lt;number&gt;(&#39;length&#39;) ?? 0
					return length &gt; 0
						? remainingMessage.replace(&#39;${x}&#39;, String(maxLength - length))
						: defaultDescription
				}
				: defaultDescription
			)
			this.set(&#39;aria-describedby&#39;, () =&gt; this.get(&#39;description&#39;)
				? description.id
				: undefined
			)

			// Effects
			this.first(&#39;.description&#39;).sync(setText(&#39;description&#39;))
			this.first(&#39;input&#39;).sync(setAttribute(&#39;aria-describedby&#39;))
		}

		// Handle spin button clicks and update their disabled state
		const spinButton = this.querySelector(&#39;.spinbutton&#39;) as HTMLElement | null
		if (!this.isNumber || !spinButton) {
			this.first(&#39;.decrement&#39;)
				.on(&#39;click&#39;, (e: Event) =&gt; {
					this.stepDown((e as MouseEvent).shiftKey ? this.step * 10 : this.step)
				}).sync(setProperty(
					&#39;disabled&#39;,
					() =&gt; isNumber(this.min) &amp;&amp; (this.get(&#39;value&#39;) ?? 0 - this.step &lt; this.min)
				))
			this.first(&#39;.increment&#39;)
				.on(&#39;click&#39;, (e: Event) =&gt; {
					this.stepUp((e as MouseEvent).shiftKey ? this.step * 10 : this.step)
				})
				.sync(setProperty(
					&#39;disabled&#39;,
					() =&gt; isNumber(this.max) &amp;&amp; (this.get(&#39;value&#39;) ?? 0 + this.step &gt; this.max)
				))
		}

		// Setup clear button
		this.first(&#39;.clear&#39;)
			.on(&#39;click&#39;, () =&gt; {
				this.clear()
				this.input?.focus()
			})
			.sync(toggleClass(&#39;hidden&#39;, &#39;empty&#39;))

		// Update value
		effect(() =&gt; {
			const value = this.get(&#39;value&#39;)
			const validate = this.getAttribute(&#39;validate&#39;)
			if (value &amp;&amp; validate) {

				// Validate input value against a server-side endpoint
				fetch(`${validate}?name=${this.input?.name}value=${this.input?.value}`)
					.then(async response =&gt; {
						const text = await response.text()
						this.input?.setCustomValidity(text)
						this.set(&#39;error&#39;, text)
					})
					.catch(err =&gt; this.set(&#39;error&#39;, err.message))
			}

			// Ensure value is a number if it is not already a number
			if (this.isNumber &amp;&amp; !isNumber(value))
				// Effect will be called again with numeric value
				return this.set(&#39;value&#39;, parseNumber(value, this.isInteger, 0))

			// Change value only if it is a valid number
			if (this.input &amp;&amp; this.isNumber &amp;&amp; Number.isFinite(value))
				this.input.value = String(value)
		})
 	}

	// Clear the input field
	clear() {
		this.set(&#39;value&#39;, &#39;&#39;)
		this.set(&#39;length&#39;, 0)
		if (this.input) {
			this.input.value = &#39;&#39;
			this.input.focus()
		}
	}

	stepUp(stepIncrement: number = this.step) {
		if (this.isNumber)
			this.#triggerChange(v =&gt; nearestStep(
				v + stepIncrement,
				this.min ?? 0,
				this.max ?? 100,
				this.step,
				this.isInteger
			))
	}

	stepDown(stepDecrement: number = this.step) {
		if (this.isNumber)
			this.#triggerChange(v =&gt; nearestStep(
				v - stepDecrement,
				this.min ?? 0,
				this.max ?? 100,
				this.step,
				this.isInteger
			))
    }

	// Trigger value-change event to commit the value change
	#triggerChange = (value: string | number | ((v: any) =&gt; string | number) | undefined)  =&gt; {
		this.set(&#39;value&#39;, value)
		this.set(&#39;error&#39;, this.input?.validationMessage)
		if (typeof value === &#39;function&#39;)
			value = this.get(&#39;value&#39;)
		if (this.input?.value !== String(value))
			this.dispatchEvent(new CustomEvent(&#39;value-change&#39;, {
				detail: value,
				bubbles: true
			}))
	}

}
InputField.define(&#39;input-field&#39;)</code></pre>
				<input-button class="copy">
					<button type="button" class="secondary small">Copy</button>
				</input-button>
			</code-block>
		</details>
	</accordion-panel>
</tab-list>
